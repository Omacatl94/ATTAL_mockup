<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATTAL Group - 1000+ Offerte di Lavoro in Italia | Agenzia per il Lavoro</title>
    <meta name="description" content="Trova lavoro vicino casa con ATTAL. 86 filiali in 71 città italiane, 21.000+ dipendenti ogni anno.">

    <!-- CSS Esterni -->
    <link rel="stylesheet" href="../assets/css/variables.css">
    <link rel="stylesheet" href="../assets/css/base.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="../assets/css/pages/homepage.css">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Leaflet MarkerCluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <style>
        /* Spinner animation for search button */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Custom Cluster Styles */
        .marker-cluster {
            background: rgba(226, 39, 33, 0.2);
            border-radius: 50%;
        }
        .marker-cluster div {
            background: #e22721;
            color: white;
            font-weight: 700;
            font-size: 14px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(226, 39, 33, 0.4);
        }
        .marker-cluster-small {
            width: 40px;
            height: 40px;
        }
        .marker-cluster-small div {
            width: 32px;
            height: 32px;
            margin: 4px;
        }
        .marker-cluster-medium {
            width: 50px;
            height: 50px;
        }
        .marker-cluster-medium div {
            width: 40px;
            height: 40px;
            margin: 5px;
            font-size: 15px;
        }
        .marker-cluster-large {
            width: 60px;
            height: 60px;
        }
        .marker-cluster-large div {
            width: 48px;
            height: 48px;
            margin: 6px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <!-- Header incluso dinamicamente -->
    <div id="header-placeholder"></div>

    <!-- HERO SECTION - SPLIT LAYOUT -->
    <section class="hero-split">
        <div class="hero-split-container">
            <!-- Left Content -->
            <div class="hero-split-content">
                <div class="hero-badge-home">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    Agenzia per il Lavoro Autorizzata
                </div>

                <h1 class="hero-split-title">
                    <span id="counter">1.084</span> Offerte di Lavoro<br>
                    <span style="color: #e22721;">Vicino a Te</span>
                </h1>

                <p class="hero-split-subtitle">
                    86 filiali in 71 città italiane. Trova il lavoro giusto nella tua zona con il supporto dei nostri consulenti.
                </p>

                <!-- SEARCH BAR -->
                <form class="hero-search-form" onsubmit="handleSearch(event)">
                    <div class="hero-search-row">
                        <div class="hero-search-field">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
                            <input type="text" placeholder="Che lavoro cerchi?" id="jobQuery">
                        </div>
                        <div class="hero-search-field">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                            <input type="text" placeholder="Dove? (es. Milano, Cagliari...)" id="cityInput">
                        </div>
                    </div>
                    <button type="submit" class="hero-search-btn">
                        Cerca Lavoro
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                    </button>
                </form>

                <!-- Quick Tags -->
                <div class="hero-quick-tags">
                    <span class="hero-tags-label">Ricerche frequenti:</span>
                    <a href="https://careers.attalgroup.it/jobs.php?country=109&keyword=magazziniere" target="_blank">Magazziniere</a>
                    <a href="https://careers.attalgroup.it/jobs.php?country=109&keyword=operaio" target="_blank">Operaio</a>
                    <a href="https://careers.attalgroup.it/jobs.php?country=109&keyword=commesso" target="_blank">Commesso</a>
                    <a href="https://careers.attalgroup.it/jobs.php?country=109&keyword=autista" target="_blank">Autista</a>
                </div>

                <!-- Trust Stats -->
                <div class="hero-trust-stats">
                    <div class="hero-trust-item">
                        <span class="hero-trust-number">21.000+</span>
                        <span class="hero-trust-label">persone assunte ogni anno</span>
                    </div>
                    <div class="hero-trust-divider"></div>
                    <div class="hero-trust-item">
                        <span class="hero-trust-number">4.6/5</span>
                        <span class="hero-trust-label">Google Reviews</span>
                    </div>
                    <div class="hero-trust-divider"></div>
                    <div class="hero-trust-item">
                        <span class="hero-trust-number">48h</span>
                        <span class="hero-trust-label">risposta media</span>
                    </div>
                </div>
            </div>

            <!-- Right Image -->
            <div class="hero-split-image">
                <img
                    src="https://images.unsplash.com/photo-1522202176988-66273c2fd55f?w=800&q=80"
                    alt="Tre persone sedute al tavolo che ridono insieme"
                    loading="eager"
                    fetchpriority="high">
                <div class="hero-image-card">
                    <div class="hero-card-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                    </div>
                    <div class="hero-card-text">
                        <strong>Sara ha trovato lavoro</strong>
                        <span>Assunta in 5 giorni a Milano</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- BRAND STRIP - Logo Grande -->
    <section class="brand-strip">
        <div class="container">
            <div class="brand-strip-content">
                <div class="brand-logo-large">
                    <svg viewBox="0 0 296.41 117.38" aria-label="ATTAL Group">
                        <g>
                            <path d="M49.98,0h-17.94L.06,82.36h19.82l6.43-16.16h29.54l6.18,16.16h19.84L49.98,0ZM33.38,47.73l7.72-19.61,7.67,19.61h-15.39Z" fill="currentColor"/>
                            <polygon points="125.17 0 125.17 18.62 110.78 18.62 110.78 82.36 91.6 82.36 91.6 18.62 77.59 18.62 77.59 0 125.17 0" fill="currentColor"/>
                            <polygon points="174.65 0 174.65 18.62 160.26 18.62 160.26 82.36 141.08 82.36 141.08 18.62 127.07 18.62 127.07 0 174.65 0" fill="currentColor"/>
                            <path d="M220.14,0h-17.94l-31.98,82.36h19.82l6.42-16.16h29.54l6.18,16.16h19.84L220.14,0ZM218.93,47.73h-15.39l7.72-19.61,7.67,19.61Z" fill="currentColor"/>
                            <polygon points="296.41 64.22 296.41 82.36 255.54 82.36 255.54 0 274.5 0 274.5 64.22 296.41 64.22" fill="currentColor"/>
                            <path d="M9.81,91.66h2.88l4.52,18.02h-3.31l-.96-3.83h-7.2l-2.06,3.83H0l9.8-18.02ZM12.1,102.66l-1.45-5.94-3.2,5.94h4.65Z" fill="currentColor"/>
                            <path d="M38,95.02l-2.84,1.83c-.82-.93-1.62-1.58-2.38-1.94s-1.63-.54-2.6-.54c-2.1,0-3.8.84-5.12,2.51-1.04,1.33-1.57,2.81-1.57,4.44s.54,2.95,1.61,4.03c1.07,1.09,2.4,1.63,3.97,1.63,1.17,0,2.23-.28,3.19-.84.96-.56,1.74-1.4,2.35-2.53h-5.66l.42-3.2h9.18c-.13,2.98-1.07,5.35-2.82,7.1-1.75,1.75-3.97,2.63-6.68,2.63-2.94,0-5.26-1.01-6.95-3.04-1.36-1.62-2.04-3.56-2.04-5.81,0-2.74.99-5.1,2.98-7.09s4.35-2.99,7.1-2.99c1.02,0,2.01.15,2.99.44.97.29,1.85.71,2.63,1.24.78.53,1.53,1.25,2.25,2.14Z" fill="currentColor"/>
                            <path d="M43.33,91.66h9.76l-.42,3.2h-6.33l-.52,3.72h6.37l-.42,3.17h-6.39l-.67,4.78h6.44l-.41,3.15h-9.88l2.48-18.02Z" fill="currentColor"/>
                            <path d="M56.68,91.66h2.97l6.54,12.25,1.69-12.25h3.32l-2.47,18.02h-2.91l-6.63-12.39-1.7,12.39h-3.27l2.45-18.02Z" fill="currentColor"/>
                            <path d="M74.3,91.66h10.24l-7.2,14.89h5.7l-.42,3.14h-10.36l7.21-14.85h-5.62l.44-3.17Z" fill="currentColor"/>
                            <path d="M87.87,91.66h3.33l-2.54,18.02h-3.27l2.48-18.02Z" fill="currentColor"/>
                            <path d="M101.24,91.66h2.88l4.52,18.02h-3.31l-.96-3.83h-7.2l-2.06,3.83h-3.66l9.8-18.02ZM103.53,102.66l-1.45-5.94-3.2,5.94h4.65Z" fill="currentColor"/>
                            <path d="M120.85,91.66h3.18c1.93,0,3.3.17,4.09.5.98.42,1.73,1,2.24,1.74.51.74.76,1.61.76,2.61,0,1.09-.3,2.08-.89,2.97-.59.89-1.39,1.53-2.39,1.94s-2.67.62-5,.66l-1.05,7.61h-3.42l2.48-18.02ZM123.26,98.89c1.85,0,3.05-.2,3.62-.58.56-.38.85-.94.85-1.68,0-.42-.11-.77-.33-1.05-.22-.29-.55-.49-.98-.6s-1.29-.17-2.57-.17l-.59,4.08Z" fill="currentColor"/>
                            <path d="M134.77,91.66h9.76l-.42,3.2h-6.33l-.52,3.72h6.37l-.42,3.17h-6.39l-.67,4.78h6.44l-.41,3.15h-9.88l2.48-18.02Z" fill="currentColor"/>
                            <path d="M148.31,91.66h3.15c1.95,0,3.32.17,4.11.5.99.42,1.73.99,2.24,1.73.5.74.75,1.61.75,2.63,0,1.25-.37,2.32-1.12,3.21s-1.88,1.52-3.38,1.87l3.95,8.08h-3.53l-3.87-7.87h-.28l-1.09,7.87h-3.41l2.48-18.02ZM150.74,98.86c1.84,0,3.04-.2,3.6-.57.56-.37.83-.93.83-1.67,0-.42-.11-.78-.33-1.07-.22-.29-.55-.49-.97-.6s-1.28-.17-2.57-.17l-.57,4.08Z" fill="currentColor"/>
                            <path d="M169.71,91.66h3.33l-2.54,18.02h-3.27l2.48-18.02Z" fill="currentColor"/>
                            <path d="M176.95,91.66h3.43l-2.08,14.92h5.63l-.4,3.1h-9.07l2.48-18.02Z" fill="currentColor"/>
                            <path d="M195.13,91.66h3.43l-2.08,14.92h5.63l-.4,3.1h-9.07l2.48-18.02Z" fill="currentColor"/>
                            <path d="M212.38,91.66h2.88l4.52,18.02h-3.31l-.96-3.83h-7.2l-2.06,3.83h-3.66l9.8-18.02ZM214.67,102.66l-1.45-5.94-3.2,5.94h4.65Z" fill="currentColor"/>
                            <path d="M222.86,91.66h3.32l3.25,13.01,7.02-13.01h3.67l-9.71,18.02h-3.04l-4.5-18.02Z" fill="currentColor"/>
                            <path d="M250.92,91.2c2.49,0,4.55.8,6.17,2.39s2.43,3.62,2.43,6.07c0,1.88-.48,3.65-1.44,5.31-.96,1.66-2.23,2.94-3.82,3.83-1.59.89-3.42,1.33-5.48,1.33-2.58,0-4.64-.76-6.19-2.28-1.54-1.52-2.31-3.52-2.31-6,0-2.82.92-5.24,2.76-7.27,2.06-2.25,4.68-3.38,7.88-3.38ZM250.79,94.4c-1.3,0-2.49.31-3.56.94s-1.94,1.52-2.6,2.7c-.66,1.17-.99,2.38-.99,3.63,0,1.48.46,2.73,1.37,3.76.91,1.03,2.22,1.54,3.94,1.54,1.98,0,3.67-.69,5.05-2.08s2.08-3.08,2.08-5.06c0-1.64-.49-2.96-1.46-3.95s-2.25-1.48-3.83-1.48Z" fill="currentColor"/>
                            <path d="M264,91.66h3.15c1.95,0,3.32.17,4.11.5.99.42,1.73.99,2.24,1.73.5.74.75,1.61.75,2.63,0,1.25-.37,2.32-1.12,3.21s-1.88,1.52-3.38,1.87l3.95,8.08h-3.53l-3.87-7.87h-.28l-1.09,7.87h-3.41l2.48-18.02ZM266.43,98.86c1.84,0,3.04-.2,3.6-.57.56-.37.83-.93.83-1.67,0-.42-.11-.78-.33-1.07-.22-.29-.55-.49-.97-.6s-1.28-.17-2.57-.17l-.57,4.08Z" fill="currentColor"/>
                            <path d="M286.79,91.2c2.49,0,4.55.8,6.17,2.39s2.43,3.62,2.43,6.07c0,1.88-.48,3.65-1.44,5.31-.96,1.66-2.23,2.94-3.82,3.83-1.59.89-3.42,1.33-5.48,1.33-2.58,0-4.64-.76-6.19-2.28-1.54-1.52-2.31-3.52-2.31-6,0-2.82.92-5.24,2.76-7.27,2.06-2.25,4.68-3.38,7.88-3.38ZM286.67,94.4c-1.3,0-2.49.31-3.56.94s-1.94,1.52-2.6,2.7c-.66,1.17-.99,2.38-.99,3.63,0,1.48.46,2.73,1.37,3.76.91,1.03,2.22,1.54,3.94,1.54,1.98,0,3.67-.69,5.05-2.08s2.08-3.08,2.08-5.06c0-1.64-.49-2.96-1.46-3.95s-2.25-1.48-3.83-1.48Z" fill="currentColor"/>
                        </g>
                    </svg>
                </div>
                <div class="brand-strip-info">
                    <p class="brand-tagline">Agenzia per il Lavoro</p>
                    <div class="brand-divider"></div>
                    <p class="brand-auth">Aut. Min. Prot. 0013582 del 03/10/2012</p>
                </div>
                <div class="brand-strip-trust">
                    <div class="trust-item">
                        <i data-lucide="shield-check"></i>
                        <span>Certificata</span>
                    </div>
                    <div class="trust-item">
                        <i data-lucide="clock"></i>
                        <span>Dal 1999</span>
                    </div>
                    <div class="trust-item">
                        <i data-lucide="map-pin"></i>
                        <span>87 Filiali</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- STATS SECTION - Modern Card Design -->
    <section class="stats">
        <div class="container">
            <!-- Single white card with all stats -->
            <div class="stats-card">
                <div class="stats-grid-modern">
                    <div class="stat-item-modern" id="stat1">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #4285F4, #34a853);">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='white' d='M44.5 20H24v8.5h11.8C34.7 33.9 30.1 37 24 37c-7.2 0-13-5.8-13-13s5.8-13 13-13c3.1 0 5.9 1.1 8.1 2.9l6.4-6.4C34.6 4.1 29.6 2 24 2 11.8 2 2 11.8 2 24s9.8 22 22 22c11 0 21-8 21-22 0-1.3-.2-2.7-.5-4z'/%3E%3C/svg%3E" alt="Google" style="width: 24px; height: 24px;">
                        </div>
                        <div class="stat-content">
                            <div class="stat-number-modern">
                                <div class="stars-container" id="stars-container"></div>
                                <span id="rating">4.6</span>/5
                            </div>
                            <div class="stat-label-modern">Google Reviews</div>
                        </div>
                    </div>

                    <div class="stat-divider"></div>

                    <div class="stat-item-modern" id="stat2">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #e22721, #c91f1a);">
                            <i data-lucide="users" style="width: 24px; height: 24px; stroke: white;"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number-modern">21.000+</div>
                            <div class="stat-label-modern">Dipendenti ogni anno</div>
                        </div>
                    </div>

                    <div class="stat-divider"></div>

                    <div class="stat-item-modern" id="stat3">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #E56E12, #cc6210);">
                            <i data-lucide="map-pin" style="width: 24px; height: 24px; stroke: white;"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number-modern">87</div>
                            <div class="stat-label-modern">Filiali in Italia</div>
                        </div>
                    </div>

                    <div class="stat-divider"></div>

                    <div class="stat-item-modern" id="stat4">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #0B8D84, #097a72);">
                            <i data-lucide="award" style="width: 24px; height: 24px; stroke: white;"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number-modern">25+</div>
                            <div class="stat-label-modern">Anni di esperienza</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- REVIEWS - Modern Design with Photos -->
            <div class="reviews-section" style="margin-top: 60px;">
                <h3 style="text-align: center; font-size: 28px; margin-bottom: 40px; color: #1f2937; font-weight: 700;">Cosa dicono di noi</h3>
                <div class="reviews-grid">
                    <!-- Review 1 - Marco -->
                    <div class="review-card-modern">
                        <p class="review-text-modern">Ho trovato lavoro in 5 giorni vicino casa. Personale super disponibile e sempre pronti ad aiutarti in ogni fase.</p>
                        <div class="review-author-modern">
                            <img
                                src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&q=80"
                                alt="Marco R."
                                class="review-avatar">
                            <div class="review-author-info">
                                <span class="review-name">Marco R.</span>
                                <span class="review-meta">Milano • 2 giorni fa</span>
                            </div>
                            <div class="review-rating">
                                <span class="stars">★★★★★</span>
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%234285F4' d='M44.5 20H24v8.5h11.8C34.7 33.9 30.1 37 24 37c-7.2 0-13-5.8-13-13s5.8-13 13-13c3.1 0 5.9 1.1 8.1 2.9l6.4-6.4C34.6 4.1 29.6 2 24 2 11.8 2 2 11.8 2 24s9.8 22 22 22c11 0 21-8 21-22 0-1.3-.2-2.7-.5-4z'/%3E%3C/svg%3E" alt="Google" style="width: 16px; height: 16px;">
                            </div>
                        </div>
                    </div>

                    <!-- Review 2 - Sara -->
                    <div class="review-card-modern">
                        <p class="review-text-modern">Mi hanno seguito dal primo giorno. Contratto serio e puntualità nei pagamenti.</p>
                        <div class="review-author-modern">
                            <img
                                src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&q=80"
                                alt="Sara L."
                                class="review-avatar">
                            <div class="review-author-info">
                                <span class="review-name">Sara L.</span>
                                <span class="review-meta">Torino • 1 settimana fa</span>
                            </div>
                            <div class="review-rating">
                                <span class="stars">★★★★★</span>
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%234285F4' d='M44.5 20H24v8.5h11.8C34.7 33.9 30.1 37 24 37c-7.2 0-13-5.8-13-13s5.8-13 13-13c3.1 0 5.9 1.1 8.1 2.9l6.4-6.4C34.6 4.1 29.6 2 24 2 11.8 2 2 11.8 2 24s9.8 22 22 22c11 0 21-8 21-22 0-1.3-.2-2.7-.5-4z'/%3E%3C/svg%3E" alt="Google" style="width: 16px; height: 16px;">
                            </div>
                        </div>
                    </div>

                    <!-- Review 3 - Luca -->
                    <div class="review-card-modern">
                        <p class="review-text-modern">Finalmente un'agenzia seria. Dopo anni di promesse vuote, ATTAL mantiene la parola.</p>
                        <div class="review-author-modern">
                            <img
                                src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&q=80"
                                alt="Luca P."
                                class="review-avatar">
                            <div class="review-author-info">
                                <span class="review-name">Luca P.</span>
                                <span class="review-meta">Bologna • 3 settimane fa</span>
                            </div>
                            <div class="review-rating">
                                <span class="stars">★★★★☆</span>
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%234285F4' d='M44.5 20H24v8.5h11.8C34.7 33.9 30.1 37 24 37c-7.2 0-13-5.8-13-13s5.8-13 13-13c3.1 0 5.9 1.1 8.1 2.9l6.4-6.4C34.6 4.1 29.6 2 24 2 11.8 2 2 11.8 2 24s9.8 22 22 22c11 0 21-8 21-22 0-1.3-.2-2.7-.5-4z'/%3E%3C/svg%3E" alt="Google" style="width: 16px; height: 16px;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CHI SIAMO - BENTO GRID SECTION -->
    <section class="chi-siamo-section">
        <div class="container">
            <h2 class="section-title">Chi Siamo</h2>
            <p style="text-align: center; font-size: 20px; color: #6b7280; margin-bottom: 50px; max-width: 700px; margin-left: auto; margin-right: auto;">
                Da oltre 25 anni aiutiamo persone e aziende a crescere insieme
            </p>

            <!-- BENTO GRID - Team Photos -->
            <div class="bento-grid">
                <!-- Large Item - Main Team Photo -->
                <div class="bento-item bento-item--large img-zoom">
                    <img
                        src="https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=800&q=80"
                        alt="Team di professionisti al lavoro"
                        width="800"
                        height="400"
                        loading="lazy"
                        style="width: 100%; height: 100%; object-fit: cover;">
                    <div class="bento-content">
                        <h3>Il Nostro Team</h3>
                        <p>200+ professionisti al tuo servizio</p>
                    </div>
                </div>

                <!-- Small Item 1 - Office/Branch -->
                <div class="bento-item img-zoom">
                    <img
                        src="https://images.unsplash.com/photo-1497366216548-37526070297c?w=400&q=80"
                        alt="Ufficio moderno e accogliente"
                        width="400"
                        height="200"
                        loading="lazy"
                        style="width: 100%; height: 100%; object-fit: cover;">
                    <div class="bento-content">
                        <h3>Le Nostre Filiali</h3>
                    </div>
                </div>

                <!-- Small Item 2 - Consultation -->
                <div class="bento-item img-zoom">
                    <img
                        src="https://images.unsplash.com/photo-1573497620053-ea5300f94f21?w=400&q=80"
                        alt="Colloquio di lavoro personalizzato"
                        width="400"
                        height="200"
                        loading="lazy"
                        style="width: 100%; height: 100%; object-fit: cover;">
                    <div class="bento-content">
                        <h3>Colloqui Personalizzati</h3>
                    </div>
                </div>

                <!-- Wide Item - Success Stories -->
                <div class="bento-item bento-item--wide img-zoom">
                    <img
                        src="https://images.unsplash.com/photo-1504384308090-c894fdcc538d?w=800&q=80"
                        alt="Professionisti al lavoro in azienda"
                        width="800"
                        height="200"
                        loading="lazy"
                        style="width: 100%; height: 100%; object-fit: cover;">
                    <div class="bento-content">
                        <h3>21.000+ Persone Assunte Ogni Anno</h3>
                        <p>Storie di successo reali</p>
                    </div>
                </div>
            </div>

            <!-- CTA sotto il Bento Grid -->
            <div style="text-align: center; margin-top: 50px;">
                <a href="chi-siamo.html" class="search-btn" style="display: inline-block; text-decoration: none; background: transparent; color: #e22721; border: 2px solid #e22721; padding: 15px 40px;">
                    SCOPRI LA NOSTRA STORIA →
                </a>
            </div>
        </div>
    </section>

    <!-- SETTORI / INDUSTRIES SECTION -->
    <section class="sectors-section">
        <div class="container">
            <h2 class="section-title">I Settori in cui Operiamo</h2>
            <p style="text-align: center; font-size: 20px; color: #6b7280; margin-bottom: 50px;">
                Esperienza specializzata in ogni industria
            </p>

            <div class="sectors-grid">
                <!-- Logistica -->
                <div class="sector-card img-zoom">
                    <img
                        src="https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?w=400&q=80"
                        alt="Operatore logistico in magazzino moderno"
                        width="300"
                        height="300"
                        loading="lazy"
                        style="width: 100%; height: 100%; object-fit: cover;">
                    <div class="sector-content">
                        <h3>Logistica</h3>
                        <p>Magazzinieri, mulettisti, picker</p>
                    </div>
                </div>

                <!-- Industria -->
                <div class="sector-card img-zoom">
                    <img
                        src="https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=400&q=80"
                        alt="Tecnico industriale al lavoro"
                        width="300"
                        height="300"
                        loading="lazy"
                        style="width: 100%; height: 100%; object-fit: cover;">
                    <div class="sector-content">
                        <h3>Industria</h3>
                        <p>Operai, tecnici, manutentori</p>
                    </div>
                </div>

                <!-- GDO / Retail -->
                <div class="sector-card img-zoom">
                    <img
                        src="https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?w=400&q=80"
                        alt="Addetto vendite in negozio"
                        width="300"
                        height="300"
                        loading="lazy"
                        style="width: 100%; height: 100%; object-fit: cover;">
                    <div class="sector-content">
                        <h3>GDO & Retail</h3>
                        <p>Commessi, cassieri, scaffalisti</p>
                    </div>
                </div>

                <!-- Hospitality -->
                <div class="sector-card img-zoom">
                    <img
                        src="https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400&q=80"
                        alt="Staff ristorazione al lavoro"
                        width="300"
                        height="300"
                        loading="lazy"
                        style="width: 100%; height: 100%; object-fit: cover;">
                    <div class="sector-content">
                        <h3>Hospitality</h3>
                        <p>Camerieri, cuochi, receptionist</p>
                    </div>
                </div>
            </div>

            <!-- Link a tutti i settori -->
            <div style="text-align: center; margin-top: 40px;">
                <a href="aziende.html" style="color: #e22721; text-decoration: none; font-weight: 600; font-size: 18px;">
                    Scopri tutti i settori →
                </a>
            </div>
        </div>
    </section>

    <!-- HOW IT WORKS - BENTO GRID VERSION -->
    <section class="how-it-works">
        <div class="container">
            <h2 class="section-title">Come ti aiutiamo a trovare lavoro</h2>

            <!-- Bento Grid per i 3 step -->
            <div class="steps-bento-grid">
                <!-- Step 1 - CERCA (Large) -->
                <div class="step-bento-card step-bento-card--large" id="step1">
                    <img
                        src="https://images.unsplash.com/photo-1586281380349-632531db7ed4?w=800&q=80"
                        alt="Persona che cerca lavoro online"
                        loading="lazy"
                        style="width: 100%; height: 100%; object-fit: cover;">
                    <div class="step-bento-overlay"></div>
                    <div class="step-bento-content">
                        <div class="step-bento-number" style="background: linear-gradient(135deg, #e22721, #c91f1a);">
                            <i data-lucide="search" style="width: 28px; height: 28px; stroke: white;"></i>
                        </div>
                        <h3>CERCA</h3>
                        <p>Esplora centinaia di offerte di lavoro vicino a te. Filtra per settore, città e tipo di contratto.</p>
                    </div>
                </div>

                <!-- Step 2 - CANDIDATI -->
                <div class="step-bento-card" id="step2">
                    <img
                        src="https://images.unsplash.com/photo-1450101499163-c8848c66ca85?w=400&q=80"
                        alt="Compilazione candidatura"
                        loading="lazy"
                        style="width: 100%; height: 100%; object-fit: cover;">
                    <div class="step-bento-overlay"></div>
                    <div class="step-bento-content">
                        <div class="step-bento-number" style="background: linear-gradient(135deg, #E56E12, #cc6210);">
                            <i data-lucide="file-text" style="width: 24px; height: 24px; stroke: white;"></i>
                        </div>
                        <h3>CANDIDATI</h3>
                        <p>Invia il CV in 2 minuti con il nostro sistema semplificato.</p>
                    </div>
                </div>

                <!-- Step 3 - LAVORA -->
                <div class="step-bento-card" id="step3">
                    <img
                        src="https://images.unsplash.com/photo-1551836022-d5d88e9218df?w=400&q=80"
                        alt="Persona soddisfatta al nuovo lavoro"
                        loading="lazy"
                        style="width: 100%; height: 100%; object-fit: cover;">
                    <div class="step-bento-overlay"></div>
                    <div class="step-bento-content">
                        <div class="step-bento-number" style="background: linear-gradient(135deg, #0B8D84, #097a72);">
                            <i data-lucide="check-circle" style="width: 24px; height: 24px; stroke: white;"></i>
                        </div>
                        <h3>LAVORA!</h3>
                        <p><strong>Ti chiamiamo in 48 ore.</strong> Garanzia ATTAL.</p>
                    </div>
                </div>
            </div>

            <!-- Stats Below Timeline -->
            <div style="display: flex; justify-content: center; gap: 30px; margin-bottom: 60px; flex-wrap: wrap;">
                <div style="text-align: center; padding: 20px 30px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <div style="font-size: 32px; font-weight: bold; color: #e22721; margin-bottom: 8px;">2 min</div>
                    <div style="color: #6b7280; font-size: 14px;">Tempo medio candidatura</div>
                </div>
                <div style="text-align: center; padding: 20px 30px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <div style="font-size: 32px; font-weight: bold; color: #e22721; margin-bottom: 8px;">48h</div>
                    <div style="color: #6b7280; font-size: 14px;">Risposta garantita</div>
                </div>
                <div style="text-align: center; padding: 20px 30px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <div style="font-size: 32px; font-weight: bold; color: #e22721; margin-bottom: 8px;">92%</div>
                    <div style="color: #6b7280; font-size: 14px;">Tasso di successo</div>
                </div>
            </div>

            <div style="text-align: center;">
                <a href="https://careers.attalgroup.it/jobs.php" target="_blank" class="search-btn" style="display: inline-block; text-decoration: none; font-size: 18px; padding: 18px 50px; background: #e22721; transition: all 0.3s ease;"
                   onmouseover="this.style.background='#c91f1a'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(226,39,33,0.4)'"
                   onmouseout="this.style.background='#e22721'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    INIZIA SUBITO →
                </a>
            </div>
        </div>
    </section>

    <!-- MAP SECTION -->
    <section class="map-section" id="filiali">
        <div class="container">
            <h2 class="section-title">86 Filiali in Tutta Italia</h2>
            <p style="text-align: center; font-size: 20px; color: #6b7280; margin-bottom: 40px;">
                Una sempre vicino a te
            </p>

            <!-- LEAFLET MAP -->
            <div id="italy-map" style="border-radius: 16px; overflow: hidden; margin-bottom: 50px; height: 600px; box-shadow: 0 8px 40px rgba(0,0,0,0.12); border: 1px solid rgba(0,0,0,0.05);"></div>

            <!-- City Cards Grid - Dynamically populated -->
            <div id="city-cards-grid" class="city-cards-grid">
                <!-- Cards will be populated from JSON -->
            </div>

            <!-- Quick City Links -->
            <div class="cities-list" id="cities-list">
                <!-- Links will be populated from JSON -->
            </div>
        </div>

        <!-- Popup Modal (hidden by default) -->
        <div id="cityPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
            <div style="background: white; border-radius: 12px; padding: 30px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 id="popupCityName" style="color: #e22721; font-size: 28px; margin: 0;"></h2>
                    <button onclick="closePopup()" style="background: none; border: none; font-size: 24px; cursor: pointer;">✕</button>
                </div>
                <div id="popupContent"></div>
                <button onclick="closePopup()" style="width: 100%; background: #e22721; color: white; padding: 12px; border: none; border-radius: 4px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 20px;">
                    Chiudi
                </button>
            </div>
        </div>
    </section>

    <!-- CTA AZIENDE -->
    <section class="cta" id="aziende" style="background: linear-gradient(135deg, #e22721 0%, #c91f1a 100%); padding: 100px 0; position: relative; overflow: hidden;">
        <!-- Animated Background Pattern -->
        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.1;">
            <div style="position: absolute; width: 300px; height: 300px; border: 2px solid white; border-radius: 50%; top: -150px; right: -150px;"></div>
            <div style="position: absolute; width: 200px; height: 200px; border: 2px solid white; border-radius: 50%; bottom: -100px; left: -100px;"></div>
            <div style="position: absolute; width: 150px; height: 150px; border: 2px solid white; border-radius: 50%; top: 50%; left: 10%; transform: translateY(-50%);"></div>
        </div>

        <div class="container" style="position: relative; z-index: 2;">
            <!-- Main Content -->
            <div style="max-width: 800px; margin: 0 auto; text-align: center;">
                <h2 style="color: white; font-size: 42px; margin-bottom: 20px; font-weight: bold;">Sei un'azienda?</h2>
                <p style="color: rgba(255,255,255,0.95); font-size: 24px; margin-bottom: 50px; font-weight: 300;">
                    Ti troviamo il personale giusto in <span style="font-weight: bold; font-size: 28px;">5 giorni</span>
                    <span style="display: block; margin-top: 10px; font-size: 18px;">Garanzia soddisfatti o rimborsati</span>
                </p>

                <!-- Services Grid -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 24px; margin-bottom: 50px;">
                    <div class="service-tile" style="background: white; padding: 40px 30px; border-radius: 16px; text-align: center; transition: all 0.3s ease; cursor: pointer;"
                         onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 20px 40px rgba(0,0,0,0.15)'"
                         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                        <div style="width: 72px; height: 72px; background: linear-gradient(135deg, #e22721 0%, #c91f1a 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
                        </div>
                        <h3 style="color: #111827; font-size: 18px; margin-bottom: 10px; font-weight: 700;">Somministrazione</h3>
                        <p style="color: #6b7280; font-size: 14px; line-height: 1.5;">Personale flessibile per ogni esigenza produttiva</p>
                    </div>

                    <div class="service-tile" style="background: white; padding: 40px 30px; border-radius: 16px; text-align: center; transition: all 0.3s ease; cursor: pointer;"
                         onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 20px 40px rgba(0,0,0,0.15)'"
                         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                        <div style="width: 72px; height: 72px; background: linear-gradient(135deg, #e22721 0%, #c91f1a 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>
                        </div>
                        <h3 style="color: #111827; font-size: 18px; margin-bottom: 10px; font-weight: 700;">Ricerca & Selezione</h3>
                        <p style="color: #6b7280; font-size: 14px; line-height: 1.5;">I migliori talenti per la tua azienda</p>
                    </div>

                    <div class="service-tile" style="background: white; padding: 40px 30px; border-radius: 16px; text-align: center; transition: all 0.3s ease; cursor: pointer;"
                         onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 20px 40px rgba(0,0,0,0.15)'"
                         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                        <div style="width: 72px; height: 72px; background: linear-gradient(135deg, #e22721 0%, #c91f1a 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
                        </div>
                        <h3 style="color: #111827; font-size: 18px; margin-bottom: 10px; font-weight: 700;">Formazione</h3>
                        <p style="color: #6b7280; font-size: 14px; line-height: 1.5;">Percorsi personalizzati di crescita professionale</p>
                    </div>
                </div>

                <!-- Stats Row -->
                <div style="display: flex; justify-content: center; gap: 50px; margin-bottom: 40px; flex-wrap: wrap;">
                    <div style="text-align: center;">
                        <div style="color: white; font-size: 36px; font-weight: bold;">3.000+</div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 14px;">Aziende clienti</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="color: white; font-size: 36px; font-weight: bold;">24h</div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 14px;">Prima proposta</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="color: white; font-size: 36px; font-weight: bold;">96%</div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 14px;">Retention rate</div>
                    </div>
                </div>

                <!-- CTA Buttons -->
                <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                    <a href="contatti.html" style="display: inline-block; background: white; color: #e22721; padding: 18px 50px; border-radius: 50px; text-decoration: none; font-size: 18px; font-weight: 600; transition: all 0.3s ease; transform: translateY(0); box-shadow: 0 10px 30px rgba(0,0,0,0.2);" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 15px 40px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 30px rgba(0,0,0,0.2)'">
                        RICHIEDI PERSONALE →
                    </a>
                    <a href="tel:02454320" style="display: inline-block; background: transparent; color: white; padding: 18px 40px; border: 2px solid white; border-radius: 50px; text-decoration: none; font-size: 18px; font-weight: 600; transition: all 0.3s ease;"
                       onmouseover="this.style.background='rgba(255,255,255,0.1)'; this.style.transform='translateY(-3px)'"
                       onmouseout="this.style.background='transparent'; this.style.transform='translateY(0)'">
                        <i data-lucide="phone" style="width: 14px; height: 14px; display: inline; vertical-align: middle;"></i> CHIAMACI ORA
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer incluso dinamicamente -->
    <div id="footer-placeholder"></div>

    <!-- Componenti Header e Footer -->
    <script src="../assets/js/attal-components.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        });
    </script>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

    <!-- Page Scripts -->
    <script>
        // Animated Counter
        function animateCounter() {
            const counter = document.getElementById('counter');
            const target = 1084;
            const duration = 2000; // 2 seconds
            const increment = target / (duration / 10);
            let current = 0;

            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                counter.textContent = Math.floor(current).toLocaleString('it-IT');
            }, 10);
        }

        // Timeline Animation
        function animateTimeline() {
            // Animate steps sequentially
            setTimeout(() => {
                const step1 = document.getElementById('step1');
                step1.style.opacity = '1';
                step1.style.transform = 'translateY(0)';
            }, 300);

            setTimeout(() => {
                const step2 = document.getElementById('step2');
                step2.style.opacity = '1';
                step2.style.transform = 'translateY(0)';
            }, 600);

            setTimeout(() => {
                const step3 = document.getElementById('step3');
                step3.style.opacity = '1';
                step3.style.transform = 'translateY(0)';
            }, 900);
        }

        // Check if element is in viewport
        function isInViewport(element) {
            const rect = element.getBoundingClientRect();
            // Attiva quando l'elemento entra nella viewport (anche parzialmente)
            return rect.top < (window.innerHeight || document.documentElement.clientHeight) && rect.bottom > 0;
        }

        // Trigger timeline animation when section starts entering view
        let timelineAnimated = false;
        window.addEventListener('scroll', () => {
            const howItWorks = document.querySelector('.how-it-works');
            if (howItWorks && !timelineAnimated) {
                const rect = howItWorks.getBoundingClientRect();
                // Attiva quando la sezione è a 200px dal fondo dello schermo
                if (rect.top < window.innerHeight - 100) {
                    timelineAnimated = true;
                    animateTimeline();
                }
            }
        });

        // Animate Stars for Google Review
        function animateStars() {
            const container = document.getElementById('stars-container');
            const stars = ['★', '★', '★', '★', '☆'];

            stars.forEach((star, index) => {
                setTimeout(() => {
                    const span = document.createElement('span');
                    span.textContent = star;
                    span.className = 'star';
                    span.style.animationDelay = `${index * 0.1}s`;
                    container.appendChild(span);
                }, index * 100);
            });
        }

        // Check if stats section is in viewport
        let statsAnimated = false;
        function checkStatsInView() {
            const statsSection = document.querySelector('.stats');
            if (statsSection && isInViewport(statsSection) && !statsAnimated) {
                statsAnimated = true;
                animateStars();
            }
        }

        // Add to scroll listener
        window.addEventListener('scroll', () => {
            checkStatsInView();

            const howItWorks = document.querySelector('.how-it-works');
            if (howItWorks && isInViewport(howItWorks) && !timelineAnimated) {
                timelineAnimated = true;
                animateTimeline();
            }
        });

        // Start counter animation when page loads
        window.addEventListener('load', () => {
            setTimeout(animateCounter, 500); // Small delay for effect

            // Check if sections are already visible on load
            checkStatsInView();

            const howItWorks = document.querySelector('.how-it-works');
            if (howItWorks && isInViewport(howItWorks)) {
                timelineAnimated = true;
                animateTimeline();
            }
        });

        // API Key OpenCage per geocoding
        const OPENCAGE_API_KEY = '307f1a8a00b34a7495e27458670cc3a2';

        // Mappa regioni italiane → codici careers.attalgroup.it
        const regionCodes = {
            "Abruzzo": "1426",
            "Basilicata": "1429",
            "Calabria": "1430",
            "Campania": "1431",
            "Emilia-Romagna": "1432",
            "Friuli Venezia Giulia": "1433",
            "Friuli-Venezia Giulia": "1433",
            "Lazio": "1434",
            "Liguria": "1435",
            "Lombardia": "1436",
            "Lombardy": "1436",
            "Marche": "1441",
            "Molise": "1437",
            "Piemonte": "1438",
            "Piedmont": "1438",
            "Puglia": "1428",
            "Apulia": "1428",
            "Sardegna": "1439",
            "Sardinia": "1439",
            "Sicilia": "1440",
            "Sicily": "1440",
            "Toscana": "1443",
            "Tuscany": "1443",
            "Trentino-Alto Adige": "1442",
            "Trentino-South Tyrol": "1442",
            "Umbria": "1444",
            "Valle d'Aosta": "1427",
            "Aosta Valley": "1427",
            "Veneto": "1445"
        };

        async function handleSearch(event) {
            event.preventDefault();

            const keyword = document.getElementById('jobQuery').value.trim();
            const city = document.getElementById('cityInput').value.trim();
            const searchBtn = document.querySelector('.hero-search-btn');

            // Costruisci URL base
            let url = 'https://careers.attalgroup.it/jobs.php?country=109';

            // Aggiungi keyword se presente
            if (keyword) {
                url += '&keyword=' + encodeURIComponent(keyword);
            }

            // Se c'è una città, usa OpenCage per trovare la regione
            if (city) {
                try {
                    // Mostra stato di caricamento
                    searchBtn.disabled = true;
                    searchBtn.innerHTML = 'Cercando... <span style="display:inline-block;width:16px;height:16px;border:2px solid #fff;border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite;"></span>';

                    const response = await fetch(
                        `https://api.opencagedata.com/geocode/v1/json?q=${encodeURIComponent(city)},Italia&key=${OPENCAGE_API_KEY}&language=it&countrycode=it`
                    );
                    const data = await response.json();

                    if (data.results && data.results.length > 0) {
                        const components = data.results[0].components;
                        const regionName = components.state || components.region;
                        const cityName = components.city || components.town || components.village || city;

                        // Trova il codice regione
                        const regionCode = regionCodes[regionName];
                        if (regionCode) {
                            url += '&region=' + regionCode;
                        }
                        url += '&address=' + encodeURIComponent(cityName);
                    } else {
                        // Se non trova nulla, passa comunque la città come address
                        url += '&address=' + encodeURIComponent(city);
                    }
                } catch (error) {
                    console.error('Errore geocoding:', error);
                    // In caso di errore, passa comunque la città
                    url += '&address=' + encodeURIComponent(city);
                } finally {
                    // Ripristina il pulsante
                    searchBtn.disabled = false;
                    searchBtn.innerHTML = 'Cerca Lavoro <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>';
                }
            }

            // Apri la pagina careers con i parametri
            window.open(url, '_blank');
        }

        // City Data for Popup
        const cityData = {
            'Milano': {
                count: 12,
                branches: [
                    { name: 'Sede Centrale', address: 'Via Marco D\'Aviano 2', phone: '02/454320' },
                    { name: 'Milano Centro', address: 'Via Roma 15', phone: '02/123456' },
                    { name: 'Milano Nord', address: 'Viale Monza 100', phone: '02/789012' },
                    { name: 'Milano Sud', address: 'Via Ripamonti 50', phone: '02/345678' }
                ]
            },
            'Roma': {
                count: 8,
                branches: [
                    { name: 'Roma Centro', address: 'Via Nazionale 20', phone: '06/123456' },
                    { name: 'Roma EUR', address: 'Viale Europa 100', phone: '06/789012' },
                    { name: 'Roma Tiburtina', address: 'Via Tiburtina 500', phone: '06/345678' }
                ]
            },
            'Torino': {
                count: 6,
                branches: [
                    { name: 'Torino Centro', address: 'Corso Francia 10', phone: '011/123456' },
                    { name: 'Torino Sud', address: 'Via Po 25', phone: '011/789012' }
                ]
            },
            'Bologna': {
                count: 5,
                branches: [
                    { name: 'Bologna Centro', address: 'Via Indipendenza 30', phone: '051/123456' },
                    { name: 'Bologna Fiera', address: 'Via Stalingrado 45', phone: '051/789012' }
                ]
            },
            'Napoli': {
                count: 4,
                branches: [
                    { name: 'Napoli Centro', address: 'Via Toledo 100', phone: '081/123456' },
                    { name: 'Napoli Vomero', address: 'Via Scarlatti 50', phone: '081/789012' }
                ]
            }
        };

        function showCityPopup(cityName, count) {
            const popup = document.getElementById('cityPopup');
            const popupCityName = document.getElementById('popupCityName');
            const popupContent = document.getElementById('popupContent');

            popupCityName.textContent = cityName;

            let content = `<p style="color: #6b7280; margin-bottom: 20px;">${count} filiali attive</p>`;

            if (cityData[cityName]) {
                content += '<div style="display: flex; flex-direction: column; gap: 15px;">';
                cityData[cityName].branches.forEach(branch => {
                    content += `
                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px;">
                            <h4 style="color: #1f2937; margin-bottom: 8px;">${branch.name}</h4>
                            <p style="color: #6b7280; font-size: 14px; margin-bottom: 4px;"><i data-lucide="map-pin" style="width: 14px; height: 14px; display: inline; vertical-align: middle; stroke: #e22721;"></i> ${branch.address}</p>
                            <p style="color: #6b7280; font-size: 14px;"><i data-lucide="phone" style="width: 14px; height: 14px; display: inline; vertical-align: middle;"></i> ${branch.phone}</p>
                        </div>
                    `;
                });
                content += '</div>';

                if (count > cityData[cityName].branches.length) {
                    content += `<p style="color: #9ca3af; font-size: 14px; margin-top: 15px; text-align: center;">
                        + altre ${count - cityData[cityName].branches.length} filiali disponibili
                    </p>`;
                }
            } else {
                content += '<p style="color: #6b7280;">Informazioni dettagliate disponibili a breve.</p>';
            }

            popupContent.innerHTML = content;
            popup.style.display = 'flex';

            // Prevent body scroll when popup is open
            document.body.style.overflow = 'hidden';
        }

        function closePopup() {
            document.getElementById('cityPopup').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Close popup when clicking outside
        document.addEventListener('DOMContentLoaded', function() {
            const popup = document.getElementById('cityPopup');
            popup.addEventListener('click', function(e) {
                if (e.target === popup) {
                    closePopup();
                }
            });
        });
    </script>

    <!-- Cookie Banner -->
    <script src="../assets/js/cookie-banner.js"></script>

    <!-- Leaflet Map Initialization -->
    <script>
        // Inizializza la mappa Leaflet
        document.addEventListener('DOMContentLoaded', function() {
            // Crea la mappa centrata sull'Italia
            const map = L.map('italy-map', {
                zoomControl: true,
                scrollWheelZoom: false,
                dragging: true,
                touchZoom: true,
                doubleClickZoom: true,
                boxZoom: false,
                keyboard: false
            }).setView([41.8, 12.5], 5.5);

            // Aggiungi tile layer (CartoDB Voyager No Labels - pulito e moderno)
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png', {
                attribution: '© OpenStreetMap © CartoDB'
            }).addTo(map);

            // Prova diversi path per il JSON
            const possiblePaths = [
                '../assets/data/filiali.json',
                '/assets/data/filiali.json',
                'assets/data/filiali.json',
                './assets/data/filiali.json'
            ];

            async function tryFetch(paths) {
                for (const path of paths) {
                    try {
                        const response = await fetch(path);
                        if (response.ok) {
                            return await response.json();
                        }
                    } catch (e) {
                        continue;
                    }
                }
                throw new Error('Impossibile caricare filiali.json');
            }

            // Carica filiali dal JSON
            tryFetch(possiblePaths)
                .then(filiali => {
                    console.log('Filiali caricate:', filiali.length);

                    // Crea il cluster group
                    const markers = L.markerClusterGroup({
                        maxClusterRadius: 50,
                        spiderfyOnMaxZoom: false,
                        showCoverageOnHover: false,
                        zoomToBoundsOnClick: false,
                        disableClusteringAtZoom: 10
                    });

                    // Icona marker singolo
                    const markerIcon = L.divIcon({
                        className: 'custom-marker',
                        html: '<div style="background: #e22721; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3);"></div>',
                        iconSize: [12, 12],
                        iconAnchor: [6, 6]
                    });

                    // Aggiungi markers al cluster
                    filiali.forEach(filiale => {
                        if (filiale.lat && filiale.lng) {
                            const marker = L.marker([filiale.lat, filiale.lng], { icon: markerIcon })
                                .bindPopup(`
                                    <div style="min-width: 200px;">
                                        <h3 style="color: #e22721; margin: 0 0 8px 0; font-size: 16px;">${filiale.citta}</h3>
                                        <p style="margin: 0 0 4px 0; font-size: 13px; color: #374151;">${filiale.indirizzo}</p>
                                        <p style="margin: 0 0 4px 0; font-size: 13px; color: #6b7280;">${filiale.tel}</p>
                                        ${filiale.rating ? `<p style="margin: 0; font-size: 13px; color: #fbbf24;">★ ${filiale.rating} (${filiale.reviews} recensioni)</p>` : ''}
                                    </div>
                                `);
                            markers.addLayer(marker);
                        }
                    });

                    // Aggiungi il cluster alla mappa
                    map.addLayer(markers);

                    // Raggruppa per città e conta
                    const cittaCount = {};
                    filiali.forEach(f => {
                        if (!cittaCount[f.citta]) {
                            cittaCount[f.citta] = { count: 0, filiali: [], regione: f.regione };
                        }
                        cittaCount[f.citta].count++;
                        cittaCount[f.citta].filiali.push(f);
                    });

                    // Ordina per numero di filiali
                    const cittaOrdinata = Object.entries(cittaCount)
                        .sort((a, b) => b[1].count - a[1].count);

                    // Popola le card (top 5 + "altre")
                    const cardsGrid = document.getElementById('city-cards-grid');
                    const top5 = cittaOrdinata.slice(0, 5);

                    top5.forEach(([citta, data]) => {
                        const firstFiliale = data.filiali[0];
                        cardsGrid.innerHTML += `
                            <div class="city-card" onclick="showCityDetails('${citta}')">
                                <div class="city-card-header">
                                    <h3>${citta}</h3>
                                    <span class="city-badge">${data.count}</span>
                                </div>
                                <p class="city-address">${firstFiliale.indirizzo.split(',')[0]}</p>
                                <p class="city-region">${data.regione}</p>
                            </div>
                        `;
                    });

                    // Card "Altre città"
                    const altreCount = cittaOrdinata.length - 5;
                    cardsGrid.innerHTML += `
                        <div class="city-card city-card-cta" onclick="window.location.href='filiali.html'">
                            <div class="city-card-header">
                                <h3>Altre città</h3>
                                <span class="city-badge">${altreCount}+</span>
                            </div>
                            <p class="city-cta-text">Scopri tutte le filiali →</p>
                            <p class="city-region">In tutta Italia</p>
                        </div>
                    `;

                    // Popola i quick links
                    const citiesList = document.getElementById('cities-list');
                    cittaOrdinata.slice(0, 8).forEach(([citta, data]) => {
                        citiesList.innerHTML += `<a href="filiali.html?citta=${encodeURIComponent(citta)}">${citta} (${data.count})</a>`;
                    });
                    citiesList.innerHTML += `<a href="filiali.html" style="font-weight: 600;">Vedi tutte →</a>`;
                })
                .catch(err => console.error('Errore caricamento filiali:', err));
        });
    </script>
</body>
</html>
