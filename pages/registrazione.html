<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrati - ATTAL Group | Trova Lavoro in 2 Minuti</title>
    <meta name="description" content="Registrati su ATTAL e trova lavoro vicino a casa. Candidatura in 1 click, ti chiamiamo entro 48 ore.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <link rel="stylesheet" href="../assets/css/variables.css">
    <link rel="stylesheet" href="../assets/css/base.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="../assets/css/pages/registrazione.css">
</head>
<body>
    <!-- Header incluso dinamicamente -->
    <div id="header-placeholder"></div>

    <!-- MAIN CONTENT - TWO COLUMN LAYOUT -->
    <div class="registration-page">

        <!-- LEFT PANEL - FORM -->
        <div class="left-panel">
            <div class="form-wrapper">

                <!-- STEPS INDICATOR -->
                <div class="progress-section">
                    <div class="steps-indicator">
                        <div class="step-item active" id="stepIndicator1">
                            <div class="step-icon"><i data-lucide="lock" stroke-width="2"></i></div>
                            <span class="step-label">Account</span>
                        </div>
                        <div class="step-item locked" id="stepIndicator2">
                            <div class="step-icon"><i data-lucide="file-text" stroke-width="2"></i></div>
                            <span class="step-label">CV</span>
                        </div>
                        <div class="step-item locked" id="stepIndicator3">
                            <div class="step-icon"><i data-lucide="user-check" stroke-width="2"></i></div>
                            <span class="step-label">Verifica</span>
                        </div>
                        <div class="step-item locked" id="stepIndicator4">
                            <div class="step-icon"><i data-lucide="sliders" stroke-width="2"></i></div>
                            <span class="step-label">Preferenze</span>
                        </div>
                    </div>
                </div>

                <!-- FORM CARD -->
                <div class="form-card">

                    <!-- STEP 1: ACCOUNT -->
                    <div class="step-screen active" id="step1">
                        <div class="step-header">
                            <div class="step-emoji"><i data-lucide="lock" stroke-width="1.5"></i></div>
                            <h1 class="step-title">Crea il tuo Account</h1>
                            <p class="step-subtitle">In 30 secondi salvi le migliori offerte su misura per te</p>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="email">Email</label>
                            <input type="email" class="form-input" id="email" placeholder="mario.rossi@email.com" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="password">Password</label>
                            <div class="password-wrapper">
                                <input type="password" class="form-input" id="password" placeholder="Minimo 8 caratteri" required>
                                <button type="button" class="password-toggle" onclick="togglePassword()"><i data-lucide="eye" stroke-width="2"></i></button>
                            </div>
                        </div>

                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="privacy" required>
                            <label class="checkbox-label" for="privacy">
                                Accetto la <a href="#" style="pointer-events: none; opacity: 0.5;" title="Pagina non disponibile">Privacy Policy</a> e i <a href="#" style="pointer-events: none; opacity: 0.5;" title="Pagina non disponibile">Termini di Servizio</a>
                            </label>
                        </div>

                        <button class="btn btn-primary" style="margin-top: 20px;" onclick="completeStep(1)" id="btnStep1">
                            CONTINUA
                            <span>‚Üí</span>
                        </button>

                        <div class="divider">
                            <span>oppure</span>
                        </div>

                        <div class="social-buttons">
                            <button class="btn-social">
                                <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                                Google
                            </button>
                            <button class="btn-social">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="#0A66C2"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                                LinkedIn
                            </button>
                        </div>

                        <p class="footer-link">
                            Hai gi√† un account? <a href="#" style="pointer-events: none; opacity: 0.5;" title="Pagina non disponibile">Accedi</a>
                        </p>
                    </div>

                    <!-- STEP 2: CV UPLOAD -->
                    <div class="step-screen" id="step2">
                        <div class="step-header">
                            <div class="step-emoji"><i data-lucide="file-text" stroke-width="1.5"></i></div>
                            <h1 class="step-title">Carica il tuo CV</h1>
                            <p class="step-subtitle">Lo leggiamo noi, tu controlli solo i dati</p>
                        </div>

                        <div class="upload-zone" id="uploadZone" onclick="document.getElementById('cvInput').click()">
                            <input type="file" id="cvInput" accept=".pdf,.doc,.docx" style="display: none;" onchange="handleFileSelect(event)">
                            <div class="upload-icon"><i data-lucide="upload-cloud" stroke-width="1.5"></i></div>
                            <p class="upload-title">Trascina qui o clicca per caricare</p>
                            <p class="upload-subtitle">PDF, DOC, DOCX ‚Äî max 5MB</p>
                            <div class="upload-file-info">
                                <span class="file-name" id="fileName"></span>
                                <button class="file-remove" onclick="removeFile(event)"><i data-lucide="x" stroke-width="2"></i></button>
                            </div>
                        </div>

                        <div class="unlock-box">
                            <div class="unlock-title">
                                <i data-lucide="gift" stroke-width="2"></i> Completa e sblocchi:
                            </div>
                            <ul class="unlock-list">
                                <li class="unlock-item">
                                    <i data-lucide="check-circle" stroke-width="2"></i>
                                    <span>Candidatura con 1 click</span>
                                </li>
                            </ul>
                            <div class="unlock-premium-item">
                                <div class="unlock-premium-badge">ESCLUSIVO</div>
                                <div class="unlock-premium-content">
                                    <i data-lucide="brain" stroke-width="2"></i>
                                    <span><strong>Sblocca pi√π offerte</strong></span>
                                </div>
                            </div>
                        </div>

                        <button class="btn btn-primary" style="margin-top: 20px;" onclick="completeStep(2)" id="btnStep2">
                            CARICA E CONTINUA
                            <span>‚Üí</span>
                        </button>

                        <button class="btn btn-link" onclick="skipStep(2)">
                            Salta per ora
                        </button>
                    </div>

                    <!-- STEP 2.5: AI ANALYSIS -->
                    <div class="step-screen" id="step2b">
                        <div class="step-header">
                            <div class="step-emoji ai-pulse"><i data-lucide="brain" stroke-width="1.5"></i></div>
                            <h1 class="step-title">La nostra AI sta lavorando</h1>
                            <p class="step-subtitle">Compiliamo tutto noi, tu rilassati</p>
                        </div>

                        <!-- AI Content with snake border -->
                        <div class="ai-content-wrapper">
                            <!-- AI Progress -->
                            <div class="ai-progress-container">
                                <div class="ai-progress-bar">
                                    <div class="ai-progress-fill" id="aiProgressFill"></div>
                                </div>
                                <div class="ai-status" id="aiStatus">Inizializzazione...</div>
                            </div>

                            <!-- Extracted data appearing -->
                            <div class="ai-extracted-data" id="aiExtractedData">
                            <div class="ai-data-item" id="aiData1">
                                <div class="ai-data-icon"><i data-lucide="user" stroke-width="2"></i></div>
                                <div class="ai-data-content">
                                    <span class="ai-data-label">Nome</span>
                                    <span class="ai-data-value">Mario Rossi</span>
                                </div>
                                <div class="ai-data-check"><i data-lucide="check" stroke-width="2.5"></i></div>
                            </div>
                            <div class="ai-data-item" id="aiData2">
                                <div class="ai-data-icon"><i data-lucide="phone" stroke-width="2"></i></div>
                                <div class="ai-data-content">
                                    <span class="ai-data-label">Telefono</span>
                                    <span class="ai-data-value">+39 333 1234567</span>
                                </div>
                                <div class="ai-data-check"><i data-lucide="check" stroke-width="2.5"></i></div>
                            </div>
                            <div class="ai-data-item" id="aiData3">
                                <div class="ai-data-icon"><i data-lucide="map-pin" stroke-width="2"></i></div>
                                <div class="ai-data-content">
                                    <span class="ai-data-label">Citt√†</span>
                                    <span class="ai-data-value">Milano</span>
                                </div>
                                <div class="ai-data-check"><i data-lucide="check" stroke-width="2.5"></i></div>
                            </div>
                            <div class="ai-data-item" id="aiData4">
                                <div class="ai-data-icon"><i data-lucide="briefcase" stroke-width="2"></i></div>
                                <div class="ai-data-content">
                                    <span class="ai-data-label">Esperienza</span>
                                    <span class="ai-data-value">2 posizioni trovate</span>
                                </div>
                                <div class="ai-data-check"><i data-lucide="check" stroke-width="2.5"></i></div>
                            </div>
                            <div class="ai-data-item" id="aiData5">
                                <div class="ai-data-icon"><i data-lucide="award" stroke-width="2"></i></div>
                                <div class="ai-data-content">
                                    <span class="ai-data-label">Competenze</span>
                                    <span class="ai-data-value">5 skills rilevate</span>
                                </div>
                                <div class="ai-data-check"><i data-lucide="check" stroke-width="2.5"></i></div>
                            </div>
                        </div>

                        <!-- Benefits box -->
                        <div class="ai-benefits">
                            <div class="ai-benefit-item">
                                <i data-lucide="clock" stroke-width="2"></i>
                                <span><strong>Risparmi 10 minuti</strong> di compilazione manuale</span>
                            </div>
                            <div class="ai-benefit-item">
                                <i data-lucide="shield-check" stroke-width="2"></i>
                                <span><strong>Zero errori</strong> di battitura</span>
                            </div>
                            <div class="ai-benefit-item">
                                <i data-lucide="target" stroke-width="2"></i>
                                <span><strong>Match migliori</strong> con le offerte giuste</span>
                            </div>
                        </div>
                        </div><!-- close ai-content-wrapper -->
                    </div>

                    <!-- STEP 3: VERIFICA DATI -->
                    <div class="step-screen" id="step3">
                        <div class="step-header">
                            <div class="step-emoji"><i data-lucide="user-check" stroke-width="1.5"></i></div>
                            <h1 class="step-title">Controlla i tuoi dati</h1>
                            <p class="step-subtitle">Abbiamo estratto questi dati dal CV</p>
                        </div>

                        <div class="data-section">
                            <div class="data-section-title">
                                <i data-lucide="user" stroke-width="2"></i> Dati personali
                            </div>
                            <div class="data-card">
                                <div class="data-row">
                                    <span class="data-label">Nome</span>
                                    <span class="data-value">
                                        Mario Rossi
                                        <button class="data-edit-btn">Modifica</button>
                                    </span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label">Telefono</span>
                                    <span class="data-value">
                                        +39 333 1234567
                                        <button class="data-edit-btn">Modifica</button>
                                    </span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label">Citt√†</span>
                                    <span class="data-value">
                                        Milano
                                        <button class="data-edit-btn">Modifica</button>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="data-section">
                            <div class="data-section-title">
                                <i data-lucide="briefcase" stroke-width="2"></i> Esperienza
                            </div>
                            <div class="data-card">
                                <div class="experience-item">
                                    <div class="experience-icon"><i data-lucide="package" stroke-width="1.5"></i></div>
                                    <div class="experience-info">
                                        <h4>Magazziniere</h4>
                                        <p>Amazon Italia ‚Äî 2022 - oggi</p>
                                    </div>
                                </div>
                                <div class="experience-item">
                                    <div class="experience-icon"><i data-lucide="wrench" stroke-width="1.5"></i></div>
                                    <div class="experience-info">
                                        <h4>Operaio generico</h4>
                                        <p>Fiat Chrysler ‚Äî 2019 - 2022</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="unlock-box">
                            <div class="unlock-title">
                                <i data-lucide="gift" stroke-width="2"></i> Completa e sblocchi:
                            </div>
                            <ul class="unlock-list">
                                <li class="unlock-item">
                                    <i data-lucide="check-circle" stroke-width="2"></i>
                                    <span>Match automatico con le offerte</span>
                                </li>
                            </ul>
                            <div class="unlock-premium-item">
                                <div class="unlock-premium-badge">ESCLUSIVO</div>
                                <div class="unlock-premium-content">
                                    <i data-lucide="brain" stroke-width="2"></i>
                                    <span><strong>Sblocca pi√π offerte</strong></span>
                                </div>
                            </div>
                        </div>

                        <button class="btn btn-primary" style="margin-top: 20px;" onclick="completeStep(3)" id="btnStep3">
                            CONFERMA E CONTINUA
                            <span>‚Üí</span>
                        </button>
                    </div>

                    <!-- STEP 4: PREFERENZE (OPZIONALE) -->
                    <div class="step-screen" id="step4">
                        <div class="step-header">
                            <div class="step-emoji"><i data-lucide="sliders" stroke-width="1.5"></i></div>
                            <h1 class="step-title">Ultime preferenze</h1>
                            <p class="step-subtitle">Opzionale ‚Äî puoi completare dopo</p>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="availability">Disponibilit√† oraria</label>
                            <select class="form-select" id="availability">
                                <option value="">Seleziona...</option>
                                <option value="fulltime">Full time</option>
                                <option value="parttime">Part time</option>
                                <option value="turni">Su turni</option>
                                <option value="weekend">Weekend</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="status">Stato attuale</label>
                            <select class="form-select" id="status">
                                <option value="">Seleziona...</option>
                                <option value="disoccupato">In cerca di lavoro</option>
                                <option value="occupato">Occupato, valuto proposte</option>
                                <option value="studente">Studente</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="distance">Distanza massima da casa</label>
                            <select class="form-select" id="distance">
                                <option value="">Seleziona...</option>
                                <option value="10">10 km</option>
                                <option value="20">20 km</option>
                                <option value="30">30 km</option>
                                <option value="50">50 km</option>
                                <option value="any">Qualsiasi distanza</option>
                            </select>
                        </div>

                        <div class="unlock-box">
                            <div class="unlock-title">
                                <i data-lucide="gift" stroke-width="2"></i> Completa e sblocchi:
                            </div>
                            <ul class="unlock-list">
                                <li class="unlock-item">
                                    <i data-lucide="check-circle" stroke-width="2"></i>
                                    <span>Offerte super-personalizzate</span>
                                </li>
                            </ul>
                            <div class="unlock-premium-item">
                                <div class="unlock-premium-badge">ESCLUSIVO</div>
                                <div class="unlock-premium-content">
                                    <i data-lucide="brain" stroke-width="2"></i>
                                    <span><strong>Sblocca pi√π offerte</strong></span>
                                </div>
                            </div>
                        </div>

                        <button class="btn btn-primary" style="margin-top: 20px;" onclick="completeStep(4)" id="btnStep4">
                            COMPLETA PROFILO
                            <span>‚úì</span>
                        </button>

                        <button class="btn btn-link" onclick="skipStep(4)">
                            Salta per ora
                        </button>
                    </div>

                    <!-- STEP 5: SUCCESS -->
                    <div class="step-screen" id="step5">
                        <div class="success-screen">
                            <div class="success-icon"><i data-lucide="check-circle" stroke-width="1.5"></i></div>
                            <h1 class="success-title">Profilo Completato!</h1>

                            <div class="success-benefits">
                                <div class="success-benefits-title">Hai sbloccato</div>
                                <div class="success-benefit-item">
                                    <i data-lucide="check" stroke-width="2.5" class="check"></i>
                                    <span>Candidatura 1-click</span>
                                </div>
                                <div class="success-benefit-item">
                                    <i data-lucide="check" stroke-width="2.5" class="check"></i>
                                    <span>Alert offerte su misura</span>
                                </div>
                                <div class="success-benefit-item">
                                    <i data-lucide="check" stroke-width="2.5" class="check"></i>
                                    <span>Visibilit√† recruiter</span>
                                </div>
                            </div>

                            <!-- Tabs Navigation -->
                            <div class="success-tabs-container">
                                <div class="success-tabs">
                                    <button class="success-tab-button active" onclick="switchSuccessTab('jobs')">
                                        <i data-lucide="briefcase"></i>
                                        Offerte per Te
                                    </button>
                                    <button class="success-tab-button" onclick="switchSuccessTab('profile')">
                                        <i data-lucide="user"></i>
                                        Il Tuo Profilo
                                    </button>
                                </div>

                                <!-- TAB 1: Offerte di Lavoro -->
                                <div class="success-tab-content active" id="tab-jobs">
                                    <div class="jobs-list" id="jobsList">
                                        <!-- Jobs will be populated by JavaScript -->
                                    </div>
                                </div>

                                <!-- TAB 2: Profilo Personale -->
                                <div class="success-tab-content" id="tab-profile">
                                    <div class="profile-preview-card">
                                        <div class="profile-preview-avatar">
                                            <i data-lucide="user" style="width: 50px; height: 50px;"></i>
                                        </div>
                                        <h3 class="profile-preview-title">Il Tuo Profilo ATTAL</h3>
                                        <p class="profile-preview-subtitle">Completa il profilo per aumentare le tue possibilit√†</p>

                                        <div class="profile-preview-progress">
                                            <div class="profile-preview-progress-title">
                                                <span>Completamento Profilo</span>
                                                <span class="profile-preview-progress-percent">75%</span>
                                            </div>
                                            <div class="profile-preview-progress-bar">
                                                <div class="profile-preview-progress-fill"></div>
                                            </div>
                                            <div class="profile-preview-tips">
                                                <div class="profile-preview-tip">
                                                    <i data-lucide="check-circle"></i>
                                                    <span>Aggiungi 5+ competenze per +15%</span>
                                                </div>
                                                <div class="profile-preview-tip">
                                                    <i data-lucide="check-circle"></i>
                                                    <span>Scrivi una bio per +10%</span>
                                                </div>
                                            </div>
                                        </div>

                                        <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 24px; line-height: 1.6;">
                                            <strong>üí° Lo sapevi?</strong><br>
                                            I profili completi ricevono <strong>3x pi√π visualizzazioni</strong> dai recruiter
                                        </p>

                                        <button class="btn-profile-cta" onclick="window.location.href='profilo.html'">
                                            <i data-lucide="arrow-right"></i>
                                            Completa il Tuo Profilo
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Trust badge -->
                <div class="trust-badge">
                    <i data-lucide="shield-check" stroke-width="2" class="trust-badge-icon"></i>
                    <span class="trust-badge-text">I tuoi dati sono al sicuro. <strong>GDPR compliant.</strong></span>
                </div>
            </div>
        </div>

        <!-- RIGHT PANEL - BENEFITS -->
        <div class="right-panel">
            <div class="right-content">
                <h2>Perch√© registrarsi?</h2>
                <p class="subtitle">Unisciti a 13.000 persone che ogni giorno trovano lavoro con ATTAL.</p>

                <ul class="benefits-list">
                    <li class="benefit-item">
                        <div class="benefit-icon"><i data-lucide="zap" stroke-width="2"></i></div>
                        <div class="benefit-text">
                            <h3>Candidatura 1-click</h3>
                            <p>Mai pi√π form lunghi. Carica il CV una volta, candidati ovunque.</p>
                        </div>
                    </li>
                    <li class="benefit-item">
                        <div class="benefit-icon"><i data-lucide="phone" stroke-width="2"></i></div>
                        <div class="benefit-text">
                            <h3>Ti chiamiamo entro 48h</h3>
                            <p>Risposta garantita. Un recruiter ti contatta personalmente.</p>
                        </div>
                    </li>
                    <li class="benefit-item">
                        <div class="benefit-icon"><i data-lucide="graduation-cap" stroke-width="2"></i></div>
                        <div class="benefit-text">
                            <h3>Formazione GRATIS</h3>
                            <p>Corsi FormaTemp inclusi. Cresci e guadagna di pi√π.</p>
                        </div>
                    </li>
                </ul>

                <!-- Premium Feature Box -->
                <div class="premium-feature-box" id="rightPremiumBox">
                    <div class="premium-header-row">
                        <div class="premium-icon">
                            <i data-lucide="brain" stroke-width="1.5"></i>
                        </div>
                        <h3>Sblocca pi√π offerte</h3>
                    </div>
                    <div class="premium-content">
                        <p>La nostra AI analizza il tuo profilo e ti mostra offerte compatibili che non avresti mai cercato. Pi√π opportunit√†, meno ricerche.</p>
                    </div>
                </div>

                <div class="stats-row-simple">
                    <div class="stat-simple">
                        <span class="stat-num">1.300+</span>
                        <span class="stat-lbl">Offerte</span>
                    </div>
                    <div class="stat-divider"></div>
                    <div class="stat-simple">
                        <span class="stat-num">80</span>
                        <span class="stat-lbl">Filiali</span>
                    </div>
                    <div class="stat-divider"></div>
                    <div class="stat-simple">
                        <span class="stat-num">4.8‚òÖ</span>
                        <span class="stat-lbl">Google</span>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- TOAST NOTIFICATION -->
    <div class="toast" id="toast">
        <i data-lucide="check-circle" stroke-width="2" class="toast-icon"></i>
        <span class="toast-message" id="toastMessage">Step completato!</span>
    </div>

    <!-- CONFETTI CONTAINER -->
    <div class="confetti-container" id="confettiContainer"></div>

    <!-- OFFERS POPUP -->
    <div class="offers-popup-overlay" id="offersPopupOverlay" onclick="closeOffersPopup()"></div>
    <div class="offers-popup" id="offersPopup">
        <div class="offers-popup-icon">
            <i data-lucide="sparkles"></i>
        </div>
        <h2 class="offers-popup-title">Offerte Sbloccate!</h2>
        <div class="offers-popup-counter" id="popupOffersCounter">0</div>
        <p class="offers-popup-subtitle">Nuove opportunit√† scoperte con l'AI</p>
        <button class="btn btn-primary" onclick="closeOffersPopup()" style="margin-top: 8px;">
            Perfetto!
        </button>
    </div>

    <script>
        // Initialize Lucide icons
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            updateStepIndicators(1);
            updateProgressBar(1);
        });

        // State
        let currentStep = 1;
        let uploadedFile = null;

        // Progress percentages for each step
        const progressMap = {
            1: 25,
            2: 50,
            3: 75,
            4: 90,
            5: 100
        };

        // Step icons for reference
        const stepIcons = ['lock', 'file-text', 'user-check', 'sliders'];

        // Go to specific step
        function goToStep(step) {
            // Hide all screens
            document.querySelectorAll('.step-screen').forEach(screen => {
                screen.classList.remove('active');
            });

            // Remove AI processing animation
            document.querySelector('.form-wrapper').classList.remove('ai-processing');

            // Show target screen
            document.getElementById(`step${step}`).classList.add('active');

            // Update step indicators
            updateStepIndicators(step);

            // Update progress bar
            updateProgressBar(step);

            currentStep = step;

            // Re-init Lucide for new content
            lucide.createIcons();

            // Special animation for step 5 (success)
            if (step === 5) {
                triggerPremiumUnlockAnimation();
            }
        }

        // Animated counter with slot machine effect (fast to slow)
        function animateCounter(element, target, duration) {
            const start = 0;
            const startTime = performance.now();

            function easeOutExpo(t) {
                return t === 1 ? 1 : 1 - Math.pow(2, -10 * t);
            }

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easedProgress = easeOutExpo(progress);
                const current = Math.floor(start + (target - start) * easedProgress);

                element.textContent = current;

                if (progress < 1) {
                    requestAnimationFrame(update);
                } else {
                    element.textContent = target;
                }
            }

            requestAnimationFrame(update);
        }

        // Premium unlock animation
        function triggerPremiumUnlockAnimation() {
            const rightBox = document.getElementById('rightPremiumBox');
            const leftBox = document.getElementById('successPremiumBox');
            const lockIcon = document.getElementById('successPremiumIcon');
            const benefitItems = document.querySelectorAll('#step5 .success-benefit-item');
            const counterEl = document.getElementById('aiOffersCounter');

            // Step 0: Animate benefit items cascade
            benefitItems.forEach((item, index) => {
                setTimeout(() => {
                    item.classList.add('animate-in');
                }, index * 200);
            });

            // Step 1: Pop out right box (after benefits animate)
            setTimeout(() => {
                rightBox.classList.add('pop-out');

                // Step 1.5: After animation, hide completely
                setTimeout(() => {
                    rightBox.style.display = 'none';
                }, 500);
            }, benefitItems.length * 200 + 300);

            // Step 2: After right box disappears, pop in left box
            setTimeout(() => {
                leftBox.classList.add('pop-in');
                lucide.createIcons();

                // Step 3: Shake the lock
                setTimeout(() => {
                    lockIcon.classList.add('unlocking');

                    // Step 4: Switch to unlocked icon and start counter
                    setTimeout(() => {
                        lockIcon.classList.remove('unlocking');
                        lockIcon.classList.add('unlocked');
                        lucide.createIcons();

                        // Step 5: Animate counter (slot machine effect)
                        animateCounter(counterEl, 43, 2000);
                    }, 600);
                }, 400);
            }, benefitItems.length * 200 + 800);
        }

        // Complete step and move to next
        function completeStep(step) {
            // Show loading state on button
            const btn = document.getElementById(`btnStep${step}`);
            if (btn) {
                btn.innerHTML = '<div class="loading-spinner"></div> Caricamento...';
                btn.disabled = true;
            }

            // Simulate processing
            setTimeout(() => {
                // Show toast
                showToast(getStepCompletedMessage(step));

                // Show confetti only at the end
                if (step === 4) {
                    createConfetti();

                    // SALVA LO STATO DI LOGIN NELLA SESSIONE
                    // Il widget cambier√† solo quando l'utente naviga ad un'altra pagina
                    // Questo permette di vedere la schermata finale senza ricaricare
                    if (typeof window.attalSetUserLoggedIn === 'function') {
                        window.attalSetUserLoggedIn();
                    }
                }

                // Special handling for step 2 -> AI analysis
                if (step === 2) {
                    goToAIAnalysis();
                } else {
                    // Move to next step
                    goToStep(step + 1);
                }

                // Reset button if exists
                if (btn) {
                    btn.innerHTML = 'CONTINUA <span>‚Üí</span>';
                    btn.disabled = false;
                }
            }, 800);
        }

        // AI Analysis step
        function goToAIAnalysis() {
            // Hide all screens
            document.querySelectorAll('.step-screen').forEach(screen => {
                screen.classList.remove('active');
            });

            // Show AI analysis screen
            document.getElementById('step2b').classList.add('active');

            // Add snake animation to form wrapper
            document.querySelector('.form-wrapper').classList.add('ai-processing');

            // Update progress bar to 50%
            updateProgressBar(2);

            // Re-init Lucide
            lucide.createIcons();

            // Start AI animation
            startAIAnimation();
        }

        // AI Animation sequence
        function startAIAnimation() {
            const progressFill = document.getElementById('aiProgressFill');
            const statusEl = document.getElementById('aiStatus');
            const dataItems = document.querySelectorAll('.ai-data-item');

            // Reset all items
            dataItems.forEach(item => item.classList.remove('visible'));
            progressFill.style.width = '0%';

            const steps = [
                { progress: 5, status: 'üìÑ Lettura documento in corso...', delay: 0 },
                { progress: 15, status: 'üîç Analisi struttura CV...', delay: 2000 },
                { progress: 28, status: 'üë§ Estrazione dati personali...', delay: 4000, showItem: 0 },
                { progress: 40, status: 'üìû Ricerca informazioni contatto...', delay: 5500, showItem: 1 },
                { progress: 52, status: 'üìç Identificazione localit√†...', delay: 7000, showItem: 2 },
                { progress: 68, status: 'üíº Analisi esperienze lavorative...', delay: 9000, showItem: 3 },
                { progress: 82, status: 'üéØ Rilevamento competenze chiave...', delay: 11000, showItem: 4 },
                { progress: 95, status: '‚ú® Ottimizzazione profilo...', delay: 12500 },
                { progress: 100, status: '‚úÖ Analisi completata!', delay: 14000 },
            ];

            steps.forEach(step => {
                setTimeout(() => {
                    progressFill.style.width = step.progress + '%';
                    statusEl.textContent = step.status;

                    if (step.showItem !== undefined) {
                        dataItems[step.showItem].classList.add('visible');
                    }

                    // Final step - go to verification
                    if (step.progress === 100) {
                        setTimeout(() => {
                            goToStep(3);
                        }, 1500);
                    }
                }, step.delay);
            });
        }

        // Skip step
        function skipStep(step) {
            // If skipping CV upload, go directly to step 3 (skip AI analysis)
            if (step === 2) {
                goToStep(3);
            } else {
                goToStep(step + 1);
            }
        }

        // Update step indicators
        function updateStepIndicators(currentStep) {
            for (let i = 1; i <= 4; i++) {
                const indicator = document.getElementById(`stepIndicator${i}`);
                const iconEl = indicator.querySelector('.step-icon');
                indicator.classList.remove('active', 'completed', 'locked');

                if (i < currentStep) {
                    indicator.classList.add('completed');
                    iconEl.innerHTML = '<i data-lucide="check" stroke-width="2.5"></i>';
                } else if (i === currentStep) {
                    indicator.classList.add('active');
                    iconEl.innerHTML = `<i data-lucide="${stepIcons[i-1]}" stroke-width="2"></i>`;
                } else {
                    indicator.classList.add('locked');
                    iconEl.innerHTML = `<i data-lucide="${stepIcons[i-1]}" stroke-width="2"></i>`;
                }
            }
            lucide.createIcons();
        }

        // Update progress bar (kept for compatibility, elements removed)
        function updateProgressBar(step) {
            // Progress bar removed from UI
        }

        // Get step completed message
        function getStepCompletedMessage(step) {
            const messages = {
                1: 'üéâ Account creato!',
                2: 'üìÑ CV ricevuto! Analizziamo...',
                3: '‚úÖ Dati confermati!',
                4: 'üéâ Profilo completato!'
            };
            return messages[step] || 'Step completato!';
        }

        // Show toast notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Toggle password visibility
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggle = document.querySelector('.password-toggle');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggle.innerHTML = '<i data-lucide="eye-off" stroke-width="2"></i>';
            } else {
                passwordInput.type = 'password';
                toggle.innerHTML = '<i data-lucide="eye" stroke-width="2"></i>';
            }
            lucide.createIcons();
        }

        // File upload handling
        const uploadZone = document.getElementById('uploadZone');
        const cvInput = document.getElementById('cvInput');

        // Drag and drop
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            // Validate file type
            const validTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            if (!validTypes.includes(file.type)) {
                alert('Per favore carica un file PDF, DOC o DOCX');
                return;
            }

            // Validate file size (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('Il file √® troppo grande. Massimo 5MB.');
                return;
            }

            uploadedFile = file;
            document.getElementById('fileName').textContent = file.name;
            uploadZone.classList.add('has-file');

            // Update upload icon
            uploadZone.querySelector('.upload-icon').innerHTML = '<i data-lucide="check-circle" stroke-width="1.5"></i>';
            uploadZone.querySelector('.upload-title').textContent = 'CV caricato!';
            lucide.createIcons();
        }

        function removeFile(event) {
            event.stopPropagation();
            uploadedFile = null;
            cvInput.value = '';
            uploadZone.classList.remove('has-file');
            uploadZone.querySelector('.upload-icon').innerHTML = '<i data-lucide="upload-cloud" stroke-width="1.5"></i>';
            uploadZone.querySelector('.upload-title').textContent = 'Trascina qui o clicca per caricare';
            lucide.createIcons();
        }

        // Confetti animation
        function createConfetti() {
            const container = document.getElementById('confettiContainer');
            const colors = ['#e22721', '#0B8D84', '#E56E12', '#e22721', '#0B8D84']; // Palette Attal: rosso, turchese, arancione

            for (let i = 0; i < 60; i++) {
                const confetti = document.createElement('div');
                confetti.style.cssText = `
                    position: absolute;
                    left: ${Math.random() * 100}%;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    width: ${Math.random() * 10 + 6}px;
                    height: ${Math.random() * 10 + 6}px;
                    border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                `;

                container.appendChild(confetti);

                confetti.animate([
                    { transform: 'translateY(-20px) rotate(0deg)', opacity: 1 },
                    { transform: `translateY(${window.innerHeight}px) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                ], {
                    duration: Math.random() * 2000 + 2000,
                    easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)',
                    delay: Math.random() * 500
                }).onfinish = () => confetti.remove();
            }
        }

        // Success Tab Switching
        function switchSuccessTab(tabName) {
            // Remove active from all tabs
            document.querySelectorAll('.success-tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.success-tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Add active to selected tab
            event.target.classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');

            // Reinitialize Lucide icons
            lucide.createIcons();
        }

        // Go to specific job offer
        function goToJobOffer(jobId) {
            // Save selected job ID in sessionStorage
            sessionStorage.setItem('attal_selected_job_id', jobId);
            // Redirect to careers page
            window.location.href = 'careers.html';
        }

        // Load real jobs for success screen
        async function loadJobsForSuccess() {
            const jobsList = document.getElementById('jobsList');
            if (!jobsList) return;

            // Carica i jobs dal JSON
            let allJobs = [];
            try {
                const response = await fetch('../assets/data/jobs.json');
                allJobs = await response.json();
            } catch (error) {
                console.error('Errore caricamento jobs:', error);
            }

            const jobs = allJobs.slice(0, 5);

            if (jobs.length === 0) {
                jobsList.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--gray-500);">Nessuna offerta disponibile al momento</p>';
                return;
            }

            // Get user city from form (default to Milano)
            const userCity = document.getElementById('city')?.value || 'Milano';

            jobsList.innerHTML = `
                ${jobs.map(job => `
                    <div class="job-card" onclick="goToJobOffer(${job.id})">
                        <div class="job-card-header">
                            <div>
                                <div class="job-card-title">${job.title}</div>
                                <div class="job-card-location">
                                    <i data-lucide="map-pin"></i>
                                    ${job.city}
                                </div>
                            </div>
                            ${job.badge ? `<span class="job-card-badge">${job.badge}</span>` : ''}
                        </div>
                        <div class="job-card-meta">
                            <div class="job-card-meta-item">
                                <i data-lucide="euro"></i>
                                ${job.salary}‚Ç¨/mese
                            </div>
                            <div class="job-card-meta-item">
                                <i data-lucide="clock"></i>
                                ${job.time}
                            </div>
                            <div class="job-card-meta-item">
                                <i data-lucide="briefcase"></i>
                                ${job.contract}
                            </div>
                        </div>
                    </div>
                `).join('')}

                <div class="jobs-list-footer">
                    <button class="btn-view-all-jobs" onclick="viewAllJobsByCity('${userCity}')">
                        <i data-lucide="briefcase"></i>
                        Vedi Tutte le Offerte
                        <span style="opacity: 0.8; font-size: 13px; font-weight: 500;">
                            (${allJobs.length} disponibili)
                        </span>
                    </button>
                </div>
            `;

            // Reinitialize Lucide icons
            lucide.createIcons();
        }

        // View all jobs filtered by city
        function viewAllJobsByCity(city) {
            // Save city filter in sessionStorage
            sessionStorage.setItem('attal_filter_city', city);
            // Redirect to careers page
            window.location.href = 'careers.html';
        }

        // Show offers popup with counter animation
        async function showOffersPopup() {
            const popup = document.getElementById('offersPopup');
            const overlay = document.getElementById('offersPopupOverlay');
            const counter = document.getElementById('popupOffersCounter');

            // Show popup and overlay
            overlay.classList.add('show');
            popup.classList.add('show');

            // Carica il numero di jobs dal JSON
            let targetNumber = 127; // fallback
            try {
                const response = await fetch('../assets/data/jobs.json');
                const jobs = await response.json();
                targetNumber = jobs.length;
            } catch (error) {
                console.error('Errore caricamento jobs:', error);
            }

            // Animate counter from 0 to target number
            const duration = 2000; // 2 seconds
            const steps = 60;
            const increment = targetNumber / steps;
            let current = 0;

            const interval = setInterval(() => {
                current += increment;
                if (current >= targetNumber) {
                    current = targetNumber;
                    clearInterval(interval);
                }
                counter.textContent = Math.floor(current);
            }, duration / steps);

            // Reinitialize Lucide icons
            lucide.createIcons();

            // Auto close after 4 seconds
            setTimeout(() => {
                closeOffersPopup();
            }, 4000);
        }

        // Close offers popup
        function closeOffersPopup() {
            const popup = document.getElementById('offersPopup');
            const overlay = document.getElementById('offersPopupOverlay');

            popup.classList.remove('show');
            overlay.classList.remove('show');
        }

        // Override goToStep to trigger popup and load jobs when reaching step 5
        const originalGoToStep = goToStep;
        goToStep = function(step) {
            originalGoToStep(step);

            // When reaching step 5 (success screen)
            if (step === 5) {
                // Wait a bit for the screen to render
                setTimeout(() => {
                    loadJobsForSuccess();
                    showOffersPopup();
                }, 500);
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateStepIndicators(1);
            updateProgressBar(1);
        });
    </script>

    <!-- Footer incluso dinamicamente -->
    <div id="footer-placeholder"></div>

    <!-- Componenti Header e Footer -->
    <script src="../assets/js/attal-components.js"></script>
</body>
</html>
