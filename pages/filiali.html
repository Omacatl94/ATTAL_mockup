<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Nostre Filiali - ATTAL Group | 86 Sedi in Tutta Italia</title>
    <meta name="description" content="Trova la filiale ATTAL più vicina a te. 86 sedi in Italia tra Temporary, Tempor, Tempus e Lavorint. Vieni a trovarci per colloqui e consulenza gratuita.">

    <link rel="stylesheet" href="../assets/css/variables.css">
    <link rel="stylesheet" href="../assets/css/base.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="../assets/css/pages/filiali.css">
</head>
<body>
    <!-- Header incluso dinamicamente -->
    <div id="header-placeholder"></div>

    <!-- HERO SECTION - Light Theme -->
    <section class="hero-light">
        <div class="container">
            <div class="hero-light-grid">
                <div class="hero-light-content">
                    <div class="hero-badge-light">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#e22721" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                        86 sedi in tutta Italia
                    </div>
                    <h1 class="hero-light-title">Trova la filiale<br><span style="color: #e22721;">più vicina a te</span></h1>
                    <p class="hero-light-subtitle">Consulenza gratuita, colloqui in giornata. Ti aspettiamo nella filiale della tua città.</p>

                    <div class="hero-geo-card">
                        <button class="geo-btn-light" id="geoBtn" onclick="trovaFilialeVicina()">
                            <div class="geo-btn-icon-light">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg>
                            </div>
                            <div class="geo-btn-text-light">
                                <span class="geo-main" id="geoBtnText">Trova filiale vicina</span>
                                <span class="geo-sub">Usa la tua posizione</span>
                            </div>
                            <svg class="geo-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                        </button>

                        <div class="geo-alt-light">
                            <span>oppure</span>
                            <a href="#filiali-section">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                                Cerca per città
                            </a>
                        </div>
                    </div>

                    <!-- Alert se nessuna filiale vicina -->
                    <div class="geo-alert-light" id="geoAlert" style="display: none;">
                        <div class="geo-alert-icon-light">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                        </div>
                        <div class="geo-alert-content-light">
                            <strong>Nessuna filiale nelle immediate vicinanze</strong>
                            <p>Ma abbiamo <strong>1084 offerte</strong> attive in tutta Italia!</p>
                            <div class="geo-alert-btns">
                                <a href="https://careers.attalgroup.it/jobs.php" target="_blank" class="geo-alert-btn primary">Cerca offerte</a>
                                <button class="geo-alert-btn secondary" onclick="document.getElementById('filiali-section').scrollIntoView({behavior: 'smooth'})">Sfoglia filiali</button>
                            </div>
                        </div>
                    </div>

                    <div class="hero-light-stats">
                        <div class="hero-light-stat">
                            <span class="stat-number">86</span>
                            <span class="stat-label">Filiali</span>
                        </div>
                        <div class="stat-divider-light"></div>
                        <div class="hero-light-stat">
                            <span class="stat-number">18</span>
                            <span class="stat-label">Regioni</span>
                        </div>
                        <div class="stat-divider-light"></div>
                        <div class="hero-light-stat">
                            <span class="stat-number">4</span>
                            <span class="stat-label">Brand</span>
                        </div>
                    </div>
                </div>

                <div class="hero-light-image">
                    <img src="https://images.unsplash.com/photo-1497366216548-37526070297c?w=800&q=80" alt="Ufficio moderno ATTAL" loading="eager">
                </div>
            </div>
        </div>
    </section>

    <!-- Old hero hidden -->
    <section class="hero" style="display: none;"></section>


    <!-- MAPPA + FILTRI -->
    <section class="filiali-section" id="filiali-section">
        <div class="container">
            <div class="filiali-wrapper">
                <!-- SIDEBAR FILTRI -->
                <aside class="filtri-sidebar">
                    <h3><i data-lucide="sliders-horizontal"></i> Cerca e filtra</h3>

                    <div class="filter-group">
                        <label><i data-lucide="search"></i> Cerca</label>
                        <div class="autocomplete-wrapper">
                            <input type="text" class="filter-input" id="searchInput" placeholder="Città o provincia..." autocomplete="off">
                            <div class="autocomplete-dropdown" id="autocompleteDropdown"></div>
                        </div>
                    </div>

                    <div class="filter-group">
                        <label><i data-lucide="map-pin"></i> Regione</label>
                        <select id="regioneFilter" onchange="filterFiliali()">
                            <option value="">Tutte le regioni</option>
                            <option value="Lombardia">Lombardia</option>
                            <option value="Lazio">Lazio</option>
                            <option value="Piemonte">Piemonte</option>
                            <option value="Veneto">Veneto</option>
                            <option value="Emilia-Romagna">Emilia-Romagna</option>
                            <option value="Toscana">Toscana</option>
                            <option value="Puglia">Puglia</option>
                            <option value="Campania">Campania</option>
                            <option value="Liguria">Liguria</option>
                            <option value="Marche">Marche</option>
                            <option value="Calabria">Calabria</option>
                            <option value="Sicilia">Sicilia</option>
                            <option value="Sardegna">Sardegna</option>
                            <option value="Abruzzo">Abruzzo</option>
                            <option value="Friuli-Venezia Giulia">Friuli-Venezia Giulia</option>
                            <option value="Umbria">Umbria</option>
                            <option value="Basilicata">Basilicata</option>
                            <option value="Molise">Molise</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label><i data-lucide="building-2"></i> Brand</label>
                        <select id="brandFilter" onchange="filterFiliali()">
                            <option value="">Tutti i brand</option>
                            <option value="Temporary">Temporary</option>
                            <option value="Tempor">Tempor</option>
                            <option value="Tempus">Tempus</option>
                            <option value="Lavorint">Lavorint</option>
                        </select>
                    </div>

                    <!-- INFO BOX FILIALE SIDEBAR -->
                    <div class="sidebar-info-box" id="sidebarInfoBox">
                        <div class="sidebar-info-header">
                            <div class="sidebar-info-title-row">
                                <div class="sidebar-info-title" id="sidebarTitle">Seleziona una filiale</div>
                                <span class="sidebar-brand-badge" id="sidebarBrand" style="background: #e22721">-</span>
                            </div>
                            <div class="sidebar-rating">
                                <span class="sidebar-stars" id="sidebarStars">★★★★★</span>
                                <span class="sidebar-rating-num" id="sidebarRating">-</span>
                                <span style="color: #9ca3af; font-size: 11px;" id="sidebarCount">(-)</span>
                            </div>
                        </div>
                        <div class="sidebar-info-body">
                            <div class="sidebar-detail">
                                <span class="sidebar-icon"><i data-lucide="map-pin"></i></span>
                                <span id="sidebarAddress">-</span>
                            </div>
                            <div class="sidebar-detail">
                                <span class="sidebar-icon"><i data-lucide="phone"></i></span>
                                <a href="tel:" id="sidebarPhone">-</a>
                            </div>
                            <div class="sidebar-detail">
                                <span class="sidebar-icon"><i data-lucide="clock"></i></span>
                                <span>Lun-Ven 9:00-18:00</span>
                            </div>
                        </div>
                        <div class="sidebar-reviews">
                            <div class="sidebar-review-title"><i data-lucide="message-circle"></i> Recensioni</div>
                            <div id="sidebarReviewsList">
                                <!-- Recensioni generate da JS -->
                            </div>
                        </div>
                        <div class="sidebar-actions">
                            <a href="#" class="sidebar-btn sidebar-btn-maps" id="sidebarMapsBtn" style="pointer-events: none; opacity: 0.5;" title="Funzionalità non disponibile in locale"><i data-lucide="map"></i> Maps</a>
                            <a href="#" class="sidebar-btn sidebar-btn-contact" id="sidebarContactBtn" style="pointer-events: none; opacity: 0.5;" title="Funzionalità non disponibile in locale"><i data-lucide="mail"></i> Email</a>
                        </div>
                    </div>

                    <button class="reset-btn" onclick="resetFilters()"><i data-lucide="refresh-cw"></i> Reset filtri</button>
                </aside>

                <!-- CONTENITORE DINAMICO: LISTA O MAPPA -->
                <div class="mappa-container" id="dinamicContainer">
                    <!-- Lista filiali (default) -->
                    <div id="filialiListView" class="filiali-list-view">
                        <div class="list-header">
                            <h3 id="listHeaderTitle"><i data-lucide="map-pin"></i> Filiali trovate</h3>
                        </div>
                        <div id="filialiCards" class="filiali-cards">
                            <!-- Cards generate da JS -->
                        </div>
                        <div id="filialiAltreContainer">
                            <!-- Altre filiali generate da JS -->
                        </div>
                    </div>

                    <!-- Mappa (nascosta di default) -->
                    <div id="mapViewContainer" style="display: none; width: 100%;">
                        <button class="back-to-results-btn" onclick="showListInRightPanel()">
                            <i data-lucide="arrow-left"></i> Torna ai risultati
                        </button>
                        <iframe
                            id="googleMap"
                            width="100%"
                            height="550"
                            style="border:0; border-radius: 12px;"
                            loading="lazy"
                            allowfullscreen
                            referrerpolicy="no-referrer-when-downgrade"
                            src="">
                        </iframe>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- VANTAGGI - Bento Grid Modern -->
    <section class="vantaggi-modern">
        <div class="container">
            <div class="vantaggi-header">
                <div class="vantaggi-badge">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                    Perché venire in filiale
                </div>
                <h2>Un supporto concreto, di persona</h2>
            </div>

            <div class="vantaggi-bento">
                <!-- Card grande con immagine -->
                <div class="vantaggio-card-large">
                    <div class="vantaggio-card-image">
                        <img src="https://images.unsplash.com/photo-1560439514-4e9645039924?w=600&q=80" alt="Consulenza in filiale" loading="lazy">
                        <div class="vantaggio-overlay">
                            <div class="vantaggio-overlay-content">
                                <span class="overlay-num">100%</span>
                                <span class="overlay-label">Gratuito</span>
                            </div>
                        </div>
                    </div>
                    <div class="vantaggio-card-body">
                        <div class="vantaggio-icon-modern red">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                        </div>
                        <h3>Consulenza Gratuita</h3>
                        <p>Parlaci delle tue competenze e aspettative. Ti guidiamo verso le migliori opportunità.</p>
                    </div>
                </div>

                <!-- Card media -->
                <div class="vantaggio-card-medium">
                    <div class="vantaggio-icon-modern orange">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
                    </div>
                    <h3>Colloquio in Giornata</h3>
                    <p>Vieni senza appuntamento, ti ricevono subito.</p>
                    <div class="vantaggio-highlight">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                        No attese
                    </div>
                </div>

                <!-- Card media -->
                <div class="vantaggio-card-medium">
                    <div class="vantaggio-icon-modern green">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                    </div>
                    <h3>Ti Chiamiamo in 48h</h3>
                    <p>Lasci il CV e ti richiamiamo con proposte concrete.</p>
                    <div class="vantaggio-highlight green">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                        Garantito
                    </div>
                </div>

                <!-- Card immagine piccola -->
                <div class="vantaggio-card-image-small">
                    <img src="https://images.unsplash.com/photo-1551836022-deb4988cc6c0?w=400&q=80" alt="Colloquio" loading="lazy">
                </div>
            </div>
        </div>
    </section>

    <!-- Old vantaggi hidden -->
    <section class="vantaggi" style="display: none;"></section>

    <!-- LA NOSTRA STORIA -->
    <section class="storia-section">
        <div class="container">
            <div class="storia-header">
                <span class="storia-label">La nostra storia</span>
                <h2>Da quattro eccellenze, un unico gruppo</h2>
                <p>ATTAL Group nasce dall'unione di quattro realtà storiche del lavoro in Italia. Oggi siamo un'unica grande famiglia con 86 filiali.</p>
            </div>

            <div class="storia-grid">
                <div class="storia-card" style="--brand-color: #4b95cf;">
                    <div class="storia-badge">Ex brand</div>
                    <div class="storia-logo">Lavorint</div>
                    <p>Protagonista nel Sud Italia e nelle Isole, ha portato in ATTAL la sua profonda conoscenza del territorio meridionale.</p>
                    <div class="storia-stat">
                        <span class="storia-num">28</span>
                        <span class="storia-lbl">sedi confluite</span>
                    </div>
                </div>
                <div class="storia-card" style="--brand-color: #c1172a;">
                    <div class="storia-badge">Ex brand</div>
                    <div class="storia-logo">Tempor</div>
                    <p>Specializzata in soluzioni flessibili nel Nord Italia, ha contribuito con la sua esperienza nella somministrazione.</p>
                    <div class="storia-stat">
                        <span class="storia-num">22</span>
                        <span class="storia-lbl">sedi confluite</span>
                    </div>
                </div>
                <div class="storia-card" style="--brand-color: #f18f03;">
                    <div class="storia-badge">Ex brand</div>
                    <div class="storia-logo">Temporary</div>
                    <p>Una delle prime agenzie per il lavoro in Italia, ha portato 25 anni di esperienza e know-how.</p>
                    <div class="storia-stat">
                        <span class="storia-num">19</span>
                        <span class="storia-lbl">sedi confluite</span>
                    </div>
                </div>
                <div class="storia-card" style="--brand-color: #df1d1d;">
                    <div class="storia-badge">Ex brand</div>
                    <div class="storia-logo">Tempus</div>
                    <p>Focalizzata su profili qualificati e settori tecnici, ha arricchito il gruppo con competenze specialistiche.</p>
                    <div class="storia-stat">
                        <span class="storia-num">17</span>
                        <span class="storia-lbl">sedi confluite</span>
                    </div>
                </div>
            </div>

            <div class="storia-oggi">
                <div class="storia-oggi-content">
                    <h3>Oggi siamo</h3>
                    <div class="storia-oggi-logo" style="display: flex; justify-content: center; margin: 20px 0;">
                        <svg viewBox="0 0 296.41 117.38" style="width: 200px; height: auto;">
                            <g>
                                <path d="M49.98,0h-17.94L.06,82.36h19.82l6.43-16.16h29.54l6.18,16.16h19.84L49.98,0ZM33.38,47.73l7.72-19.61,7.67,19.61h-15.39Z" fill="#e22721"/>
                                <polygon points="125.17 0 125.17 18.62 110.78 18.62 110.78 82.36 91.6 82.36 91.6 18.62 77.59 18.62 77.59 0 125.17 0" fill="#e22721"/>
                                <polygon points="174.65 0 174.65 18.62 160.26 18.62 160.26 82.36 141.08 82.36 141.08 18.62 127.07 18.62 127.07 0 174.65 0" fill="#e22721"/>
                                <path d="M220.14,0h-17.94l-31.98,82.36h19.82l6.42-16.16h29.54l6.18,16.16h19.84L220.14,0ZM218.93,47.73h-15.39l7.72-19.61,7.67,19.61Z" fill="#e22721"/>
                                <polygon points="296.41 64.22 296.41 82.36 255.54 82.36 255.54 0 274.5 0 274.5 64.22 296.41 64.22" fill="#e22721"/>
                                <path d="M9.81,91.66h2.88l4.52,18.02h-3.31l-.96-3.83h-7.2l-2.06,3.83H0l9.8-18.02ZM12.1,102.66l-1.45-5.94-3.2,5.94h4.65Z" fill="#e22721"/>
                                <path d="M38,95.02l-2.84,1.83c-.82-.93-1.62-1.58-2.38-1.94s-1.63-.54-2.6-.54c-2.1,0-3.8.84-5.12,2.51-1.04,1.33-1.57,2.81-1.57,4.44s.54,2.95,1.61,4.03c1.07,1.09,2.4,1.63,3.97,1.63,1.17,0,2.23-.28,3.19-.84.96-.56,1.74-1.4,2.35-2.53h-5.66l.42-3.2h9.18c-.13,2.98-1.07,5.35-2.82,7.1-1.75,1.75-3.97,2.63-6.68,2.63-2.94,0-5.26-1.01-6.95-3.04-1.36-1.62-2.04-3.56-2.04-5.81,0-2.74.99-5.1,2.98-7.09s4.35-2.99,7.1-2.99c1.02,0,2.01.15,2.99.44.97.29,1.85.71,2.63,1.24.78.53,1.53,1.25,2.25,2.14Z" fill="#e22721"/>
                                <path d="M43.33,91.66h9.76l-.42,3.2h-6.33l-.52,3.72h6.37l-.42,3.17h-6.39l-.67,4.78h6.44l-.41,3.15h-9.88l2.48-18.02Z" fill="#e22721"/>
                                <path d="M56.68,91.66h2.97l6.54,12.25,1.69-12.25h3.32l-2.47,18.02h-2.91l-6.63-12.39-1.7,12.39h-3.27l2.45-18.02Z" fill="#e22721"/>
                                <path d="M74.3,91.66h10.24l-7.2,14.89h5.7l-.42,3.14h-10.36l7.21-14.85h-5.62l.44-3.17Z" fill="#e22721"/>
                                <path d="M87.87,91.66h3.33l-2.54,18.02h-3.27l2.48-18.02Z" fill="#e22721"/>
                                <path d="M101.24,91.66h2.88l4.52,18.02h-3.31l-.96-3.83h-7.2l-2.06,3.83h-3.66l9.8-18.02ZM103.53,102.66l-1.45-5.94-3.2,5.94h4.65Z" fill="#e22721"/>
                                <path d="M120.85,91.66h3.18c1.93,0,3.3.17,4.09.5.98.42,1.73,1,2.24,1.74.51.74.76,1.61.76,2.61,0,1.09-.3,2.08-.89,2.97-.59.89-1.39,1.53-2.39,1.94s-2.67.62-5,.66l-1.05,7.61h-3.42l2.48-18.02ZM123.26,98.89c1.85,0,3.05-.2,3.62-.58.56-.38.85-.94.85-1.68,0-.42-.11-.77-.33-1.05-.22-.29-.55-.49-.98-.6s-1.29-.17-2.57-.17l-.59,4.08Z" fill="#e22721"/>
                                <path d="M134.77,91.66h9.76l-.42,3.2h-6.33l-.52,3.72h6.37l-.42,3.17h-6.39l-.67,4.78h6.44l-.41,3.15h-9.88l2.48-18.02Z" fill="#e22721"/>
                                <path d="M148.31,91.66h3.15c1.95,0,3.32.17,4.11.5.99.42,1.73.99,2.24,1.73.5.74.75,1.61.75,2.63,0,1.25-.37,2.32-1.12,3.21s-1.88,1.52-3.38,1.87l3.95,8.08h-3.53l-3.87-7.87h-.28l-1.09,7.87h-3.41l2.48-18.02ZM150.74,98.86c1.84,0,3.04-.2,3.6-.57.56-.37.83-.93.83-1.67,0-.42-.11-.78-.33-1.07-.22-.29-.55-.49-.97-.6s-1.28-.17-2.57-.17l-.57,4.08Z" fill="#e22721"/>
                                <path d="M169.71,91.66h3.33l-2.54,18.02h-3.27l2.48-18.02Z" fill="#e22721"/>
                                <path d="M176.95,91.66h3.43l-2.08,14.92h5.63l-.4,3.1h-9.07l2.48-18.02Z" fill="#e22721"/>
                                <path d="M195.13,91.66h3.43l-2.08,14.92h5.63l-.4,3.1h-9.07l2.48-18.02Z" fill="#e22721"/>
                                <path d="M212.38,91.66h2.88l4.52,18.02h-3.31l-.96-3.83h-7.2l-2.06,3.83h-3.66l9.8-18.02ZM214.67,102.66l-1.45-5.94-3.2,5.94h4.65Z" fill="#e22721"/>
                                <path d="M222.86,91.66h3.32l3.25,13.01,7.02-13.01h3.67l-9.71,18.02h-3.04l-4.5-18.02Z" fill="#e22721"/>
                                <path d="M250.92,91.2c2.49,0,4.55.8,6.17,2.39s2.43,3.62,2.43,6.07c0,1.88-.48,3.65-1.44,5.31-.96,1.66-2.23,2.94-3.82,3.83-1.59.89-3.42,1.33-5.48,1.33-2.58,0-4.64-.76-6.19-2.28-1.54-1.52-2.31-3.52-2.31-6,0-2.82.92-5.24,2.76-7.27,2.06-2.25,4.68-3.38,7.88-3.38ZM250.79,94.4c-1.3,0-2.49.31-3.56.94s-1.94,1.52-2.6,2.7c-.66,1.17-.99,2.38-.99,3.63,0,1.48.46,2.73,1.37,3.76.91,1.03,2.22,1.54,3.94,1.54,1.98,0,3.67-.69,5.05-2.08s2.08-3.08,2.08-5.06c0-1.64-.49-2.96-1.46-3.95s-2.25-1.48-3.83-1.48Z" fill="#e22721"/>
                                <path d="M264,91.66h3.15c1.95,0,3.32.17,4.11.5.99.42,1.73.99,2.24,1.73.5.74.75,1.61.75,2.63,0,1.25-.37,2.32-1.12,3.21s-1.88,1.52-3.38,1.87l3.95,8.08h-3.53l-3.87-7.87h-.28l-1.09,7.87h-3.41l2.48-18.02ZM266.43,98.86c1.84,0,3.04-.2,3.6-.57.56-.37.83-.93.83-1.67,0-.42-.11-.78-.33-1.07-.22-.29-.55-.49-.97-.6s-1.28-.17-2.57-.17l-.57,4.08Z" fill="#e22721"/>
                                <path d="M286.79,91.2c2.49,0,4.55.8,6.17,2.39s2.43,3.62,2.43,6.07c0,1.88-.48,3.65-1.44,5.31-.96,1.66-2.23,2.94-3.82,3.83-1.59.89-3.42,1.33-5.48,1.33-2.58,0-4.64-.76-6.19-2.28-1.54-1.52-2.31-3.52-2.31-6,0-2.82.92-5.24,2.76-7.27,2.06-2.25,4.68-3.38,7.88-3.38ZM286.67,94.4c-1.3,0-2.49.31-3.56.94s-1.94,1.52-2.6,2.7c-.66,1.17-.99,2.38-.99,3.63,0,1.48.46,2.73,1.37,3.76.91,1.03,2.22,1.54,3.94,1.54,1.98,0,3.67-.69,5.05-2.08s2.08-3.08,2.08-5.06c0-1.64-.49-2.96-1.46-3.95s-2.25-1.48-3.83-1.48Z" fill="#e22721"/>
                            </g>
                        </svg>
                    </div>
                    <p>Un'unica identità, 86 filiali, lo stesso impegno: trovare il lavoro giusto per ogni persona.</p>
                    <div class="storia-oggi-text">
                        <div class="storia-oggi-stat">
                            <span class="num">86</span>
                            <span class="lbl">filiali in Italia</span>
                        </div>
                        <div class="storia-oggi-stat">
                            <span class="num">18</span>
                            <span class="lbl">regioni coperte</span>
                        </div>
                        <div class="storia-oggi-stat">
                            <span class="num">1</span>
                            <span class="lbl">grande famiglia</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA FINALE - Modern with Background Image -->
    <section class="cta-filiali-modern">
        <div class="cta-bg-image">
            <img src="https://images.unsplash.com/photo-1521737604893-d14cc237f11d?w=1600&q=80" alt="Team al lavoro" loading="lazy">
            <div class="cta-overlay"></div>
        </div>
        <div class="container">
            <div class="cta-filiali-content">
                <div class="cta-icon-wrap">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                </div>
                <h2>Non trovi la tua città?</h2>
                <p>Chiamaci o scrivici, ti aiutiamo noi a trovare la soluzione più vicina a te.</p>

                <div class="cta-contacts-row">
                    <a href="tel:02454320" class="cta-contact-btn primary">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                        02 454 320
                    </a>
                    <a href="mailto:info@attal.it" class="cta-contact-btn secondary">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                        info@attal.it
                    </a>
                </div>

                <div class="cta-trust-row">
                    <div class="cta-trust-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                        Risposta garantita
                    </div>
                    <div class="cta-trust-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                        Consulenza gratuita
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Old CTA hidden -->
    <section class="cta-finale" style="display: none;"></section>

    <!-- Footer incluso dinamicamente -->
    <div id="footer-placeholder"></div>

    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
        // Database filiali caricato da JSON esterno
        let filiali = [];
        let filialiFiltered = [];

        // Carica filiali da JSON
        async function loadFiliali() {
            try {
                // Determina il path base in base all'URL
                const isInSubfolder = window.location.pathname.includes('/pages/');
                const basePath = isInSubfolder ? '../' : '/';
                const response = await fetch(basePath + 'assets/data/filiali.json');
                if (!response.ok) throw new Error('HTTP ' + response.status);
                filiali = await response.json();
                filialiFiltered = [...filiali];
                console.log(`Caricate ${filiali.length} filiali da JSON`);
                // Inizializza la pagina dopo il caricamento
                setupAutocomplete();
                generateFilialiCards();
                if (typeof lucide !== 'undefined') lucide.createIcons();
            } catch (error) {
                console.error('Errore caricamento filiali:', error);
            }
        }

        // Brand colors
        const brandColors = {
            'Tempus': '#df1d1d',
            'Temporary': '#f18f03',
            'Lavorint': '#4b95cf',
            'Tempor': '#c1172a'
        };

        // Recensioni template
        const recensioniTemplate = [
            { nome: "Marco R.", testo: "Professionali e veloci. Trovato lavoro in 3 giorni!", stelle: 5 },
            { nome: "Laura B.", testo: "Consulenti preparati, mi hanno seguito fino all'assunzione.", stelle: 5 },
            { nome: "Giuseppe M.", testo: "Finalmente un'agenzia seria! Consigliatissimi!", stelle: 5 },
            { nome: "Francesca T.", testo: "Personale cordiale e competente. Ottima esperienza.", stelle: 5 },
            { nome: "Alessandro P.", testo: "Mi hanno aiutato a trovare il lavoro perfetto!", stelle: 5 },
            { nome: "Chiara S.", testo: "Ambiente accogliente, consulenti top.", stelle: 4 },
            { nome: "Roberto V.", testo: "Esperienza positiva. Buona assistenza.", stelle: 4 },
            { nome: "Simona L.", testo: "Finalmente ho trovato stabilità lavorativa!", stelle: 5 }
        ];

        // Posizione simulata: Milano centro
        const MOCK_POSITION = { lat: 45.4642, lng: 9.1900 };

        // Formula Haversine
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function trovaFilialeVicina() {
            const btn = document.getElementById('geoBtn');
            const alert = document.getElementById('geoAlert');
            btn.classList.add('loading');
            btn.querySelector('.geo-text').textContent = 'Rilevamento posizione';

            setTimeout(() => {
                const filialiConDistanza = filiali.map(f => {
                    if (f.lat && f.lng) {
                        const distanza = calculateDistance(MOCK_POSITION.lat, MOCK_POSITION.lng, f.lat, f.lng);
                        return { ...f, distanza: distanza };
                    }
                    return { ...f, distanza: 9999 };
                });
                filialiConDistanza.sort((a, b) => a.distanza - b.distanza);
                const filialiVicine = filialiConDistanza.slice(0, 10);
                const hasFilialeVicina = filialiVicine[0].distanza <= 10;

                if (hasFilialeVicina) {
                    filialiFiltered = filialiVicine;
                    generateFilialiCardsWithDistance();
                    document.querySelector('.filiali-section').scrollIntoView({ behavior: 'smooth' });
                    alert.style.display = 'none';
                } else {
                    alert.style.display = 'flex';
                }
                btn.classList.remove('loading');
                btn.querySelector('.geo-text').textContent = 'Trova filiale vicina';
            }, 800);
        }

        function generateFilialiCardsWithDistance() {
            const container = document.getElementById('filialiCards');
            const headerTitle = document.getElementById('listHeaderTitle');

            if (filialiFiltered.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #9ca3af; padding: 40px 0;">Nessuna filiale trovata</p>';
                headerTitle.innerHTML = '<i data-lucide="map-pin"></i> Nessuna filiale trovata';
                return;
            }

            headerTitle.innerHTML = `<i data-lucide="map-pin"></i> ${filialiFiltered.length} ${filialiFiltered.length === 1 ? 'filiale trovata' : 'filiali trovate'}`;

            const top3 = filialiFiltered.slice(0, 3);
            const resto = filialiFiltered.slice(3);
            const altreContainer = document.getElementById('filialiAltreContainer');

            // Cards principali nella griglia
            container.innerHTML = top3.map(f => {
                const filialeJson = JSON.stringify(f).replace(/"/g, '&quot;').replace(/'/g, '&#39;');
                const distanzaBadge = f.distanza && f.distanza < 9999 ?
                    (f.distanza <= 10 ?
                        `<div class="distanza-badge vicina"><i data-lucide="navigation"></i> A soli ${f.distanza.toFixed(1)} km da te</div>` :
                        `<div class="distanza-badge normale"><i data-lucide="map-pin"></i> ${f.distanza.toFixed(1)} km da te</div>`
                    ) : '';

                return `
                    <div class="filiale-card" onclick='selectFiliale(${filialeJson})'>
                        ${distanzaBadge}
                        <div class="filiale-card-header">
                            <div class="filiale-card-title">${f.citta}</div>
                            <span class="filiale-card-brand" style="background: ${brandColors[f.brand]}">${f.brand}</span>
                        </div>
                        <button class="filiale-card-btn" style="--brand-color: ${brandColors[f.brand]}">Scopri dettagli</button>
                    </div>
                `;
            }).join('');

            // Altre filiali sotto la griglia
            if (resto.length > 0) {
                altreContainer.innerHTML = `
                    <div class="filiali-divider"><span>Altre filiali nelle vicinanze</span></div>
                    <div class="filiali-list-compact">
                        ${resto.map(f => {
                            const filialeJson = JSON.stringify(f).replace(/"/g, '&quot;').replace(/'/g, '&#39;');
                            const distanzaText = f.distanza && f.distanza < 9999 ? `${f.distanza.toFixed(1)} km` : '-';
                            return `
                                <div class="filiale-compact-item" onclick='selectFiliale(${filialeJson})'>
                                    <span class="filiale-compact-citta">${f.citta}</span>
                                    <span class="filiale-compact-divider">•</span>
                                    <span class="filiale-compact-distanza">${distanzaText}</span>
                                    <span class="filiale-compact-divider">•</span>
                                    <span class="filiale-compact-brand" style="color: ${brandColors[f.brand]}">${f.brand}</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            } else {
                altreContainer.innerHTML = '';
            }

            lucide.createIcons();
        }

        function scrollToManualSearch() {
            document.getElementById('manualSearchSection').scrollIntoView({ behavior: 'smooth' });
        }

        function showFilialeInfo(filiale) {
            const infoBox = document.getElementById('sidebarInfoBox');
            // Usa i dati reali dal JSON
            const rating = filiale.rating ? filiale.rating.toFixed(1) : 'N/A';
            const reviewCount = filiale.reviews || 0;
            const fullStars = filiale.rating ? Math.floor(filiale.rating) : 0;
            const stars = '★'.repeat(fullStars) + '☆'.repeat(5 - fullStars);
            const shuffled = [...recensioniTemplate].sort(() => 0.5 - Math.random());
            const selectedReviews = shuffled.slice(0, 2);

            document.getElementById('sidebarTitle').textContent = filiale.citta;
            document.getElementById('sidebarBrand').textContent = filiale.brand;
            document.getElementById('sidebarBrand').style.background = brandColors[filiale.brand];

            const headerElement = document.querySelector('.sidebar-info-header');
            const brandColor = brandColors[filiale.brand];

            headerElement.style.background = 'transparent';
            headerElement.style.borderBottomColor = brandColor;

            document.getElementById('sidebarStars').textContent = stars;
            document.getElementById('sidebarRating').textContent = rating;
            document.getElementById('sidebarCount').textContent = `(${reviewCount} recensioni)`;
            document.getElementById('sidebarAddress').textContent = filiale.indirizzo;
            document.getElementById('sidebarPhone').href = `tel:${filiale.tel ? filiale.tel.replace(/[\s\/]/g, '') : ''}`;
            document.getElementById('sidebarPhone').textContent = filiale.tel || 'N/A';

            const reviewsHTML = selectedReviews.map(r => `
                <div class="sidebar-review-item">
                    <div class="sidebar-review-header">
                        <span class="sidebar-review-name">${r.nome}</span>
                        <span class="sidebar-review-stars">${'★'.repeat(r.stelle)}${'☆'.repeat(5-r.stelle)}</span>
                    </div>
                    <div class="sidebar-review-text">"${r.testo}"</div>
                </div>
            `).join('');

            document.getElementById('sidebarReviewsList').innerHTML = reviewsHTML;

            const mapsBtn = document.getElementById('sidebarMapsBtn');
            mapsBtn.href = '#';
            mapsBtn.onclick = (e) => { e.preventDefault(); showMapInRightPanel(filiale); };
            document.getElementById('sidebarContactBtn').href = `mailto:${filiale.email}`;

            infoBox.classList.add('show');

            if (filiale.lat && filiale.lng) {
                const iframe = document.getElementById('googleMap');
                iframe.src = `https://www.google.com/maps/embed/v1/view?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&center=${filiale.lat},${filiale.lng}&zoom=15&maptype=roadmap`;
            }
        }

        function setupAutocomplete() {
            const input = document.getElementById('searchInput');
            const dropdown = document.getElementById('autocompleteDropdown');

            input.addEventListener('input', (e) => {
                const value = e.target.value.toLowerCase().trim();
                if (value.length < 2) { dropdown.classList.remove('show'); return; }

                const matches = filiali.filter(f => f.citta.toLowerCase().includes(value)).slice(0, 8);
                if (matches.length === 0) { dropdown.classList.remove('show'); return; }

                dropdown.innerHTML = matches.map(f => {
                    const highlighted = f.citta.replace(new RegExp(value, 'gi'), match => `<strong>${match}</strong>`);
                    return `<div class="autocomplete-item" onclick="selectCity('${f.citta}')">${highlighted}<span class="brand-tag" style="background: ${brandColors[f.brand]}">${f.brand}</span></div>`;
                }).join('');
                dropdown.classList.add('show');
            });

            document.addEventListener('click', (e) => {
                if (!e.target.closest('.autocomplete-wrapper')) dropdown.classList.remove('show');
            });
        }

        function selectCity(citta) {
            document.getElementById('searchInput').value = citta;
            document.getElementById('autocompleteDropdown').classList.remove('show');
            const filiale = filiali.find(f => f.citta === citta);
            if (filiale) showFilialeInfo(filiale);
            filterFiliali();
        }


        let hasSearched = false;

        function generateFilialiCards() {
            const container = document.getElementById('filialiCards');
            const headerTitle = document.getElementById('listHeaderTitle');
            const altreContainer = document.getElementById('filialiAltreContainer');

            // Pulisci la sezione "altre filiali" (usata solo per geolocalizzazione)
            altreContainer.innerHTML = '';

            if (filialiFiltered.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #9ca3af; padding: 40px 0;">Nessuna filiale trovata</p>';
                headerTitle.innerHTML = '<i data-lucide="map-pin"></i> Nessuna filiale trovata';
                return;
            }

            if (hasSearched) {
                headerTitle.innerHTML = `<i data-lucide="map-pin"></i> ${filialiFiltered.length} ${filialiFiltered.length === 1 ? 'filiale trovata' : 'filiali trovate'}`;
            } else {
                headerTitle.innerHTML = '<i data-lucide="map-pin"></i> Tutte le filiali';
            }

            container.innerHTML = filialiFiltered.map(f => {
                const filialeJson = JSON.stringify(f).replace(/"/g, '&quot;').replace(/'/g, '&#39;');
                return `
                    <div class="filiale-card" onclick='selectFiliale(${filialeJson})'>
                        <div class="filiale-card-header">
                            <div class="filiale-card-title">${f.citta}</div>
                            <span class="filiale-card-brand" style="background: ${brandColors[f.brand]}">${f.brand}</span>
                        </div>
                        <button class="filiale-card-btn" style="--brand-color: ${brandColors[f.brand]}">Scopri dettagli</button>
                    </div>
                `;
            }).join('');
            lucide.createIcons();
        }

        function selectFiliale(filiale) { showFilialeInfo(filiale); }

        function showMapInRightPanel(filiale) {
            const listView = document.getElementById('filialiListView');
            const mapContainer = document.getElementById('mapViewContainer');
            const mapIframe = document.getElementById('googleMap');
            listView.style.display = 'none';
            mapContainer.style.display = 'block';
            const mapsQuery = encodeURIComponent(`${filiale.indirizzo}, ${filiale.citta}`);
            mapIframe.src = `https://www.google.com/maps/embed/v1/place?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&q=${mapsQuery}&zoom=15`;
        }

        function showListInRightPanel() {
            document.getElementById('filialiListView').style.display = 'block';
            document.getElementById('mapViewContainer').style.display = 'none';
        }

        function filterFiliali() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const regioneFilter = document.getElementById('regioneFilter').value;
            const brandFilter = document.getElementById('brandFilter').value;

            hasSearched = true;

            filialiFiltered = filiali.filter(filiale => {
                const matchSearch = !searchText || filiale.citta.toLowerCase().includes(searchText) || filiale.indirizzo.toLowerCase().includes(searchText);
                const matchRegione = !regioneFilter || filiale.regione === regioneFilter;
                const matchBrand = !brandFilter || filiale.brand === brandFilter;
                return matchSearch && matchRegione && matchBrand;
            });

            generateFilialiCards();
            showListInRightPanel();
        }

        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('regioneFilter').value = '';
            document.getElementById('brandFilter').value = '';
            hasSearched = false;
            filialiFiltered = [...filiali];
            generateFilialiCards();
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Carica filiali da JSON e inizializza
            loadFiliali();
            document.getElementById('searchInput').addEventListener('keyup', (e) => {
                if (e.key === 'Enter') filterFiliali();
            });
            document.getElementById('searchInput').addEventListener('input', () => {
                filterFiliali();
            });
        });
    </script>

    <!-- Componenti Header e Footer -->
    <script src="../assets/js/attal-components.js"></script>
</body>
</html>
