<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Nostre Filiali - ATTAL Group | 88 Sedi in Tutta Italia</title>
    <meta name="description" content="Trova la filiale ATTAL pi√π vicina a te. 88 sedi in Italia tra Temporary, Tempor, Tempus e Lavorint. Vieni a trovarci per colloqui e consulenza gratuita.">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #1f2937;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* HEADER - Identico homepage */
        header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 20px 0;
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #e22721;
            text-decoration: none;
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
            list-style: none;
        }
        
        .nav-links a {
            color: #1f2937;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        .nav-links a:hover,
        .nav-links a.active {
            color: #e22721;
        }
        
        /* HERO SECTION */
        .hero {
            background: linear-gradient(135deg, #e22721 0%, #c91f1a 100%);
            padding: 100px 0 80px;
            text-align: center;
        }
        
        .hero h1 {
            font-size: 52px;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
        }
        
        .hero .subtitle {
            font-size: 22px;
            color: rgba(255,255,255,0.95);
            margin-bottom: 50px;
        }
        
        /* BOTTONE GEOLOCALIZZAZIONE */
        .geo-btn {
            background: white;
            color: #e22721;
            border: none;
            padding: 20px 50px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 12px;
        }
        
        .geo-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.4);
        }
        
        .geo-btn:active {
            transform: translateY(-1px);
        }
        
        .geo-icon {
            font-size: 24px;
        }
        
        .geo-btn.loading .geo-text::after {
            content: '...';
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        /* ALERT NESSUNA FILIALE VICINA */
        .geo-alert {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin: 40px auto 0;
            max-width: 600px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: flex;
            gap: 20px;
            text-align: left;
        }
        
        .geo-alert-icon {
            font-size: 40px;
            flex-shrink: 0;
        }
        
        .geo-alert-content h3 {
            color: #1f2937;
            font-size: 20px;
            margin-bottom: 8px;
        }
        
        .geo-alert-content p {
            color: #6b7280;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .geo-alert-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .geo-alert-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .geo-alert-btn.primary {
            background: #e22721;
            color: white;
            border: none;
        }
        
        .geo-alert-btn.primary:hover {
            background: #c91f1a;
        }
        
        .geo-alert-btn.secondary {
            background: white;
            color: #e22721;
            border: 2px solid #e22721;
        }
        
        .geo-alert-btn.secondary:hover {
            background: #fee2e2;
        }
        
        /* SEZIONE RICERCA MANUALE */
        .search-section {
            background: #f9fafb;
            padding: 60px 0 40px;
            text-align: center;
        }
        
        .search-section h2 {
            font-size: 32px;
            color: #1f2937;
            margin-bottom: 10px;
        }
        
        .search-subtitle {
            font-size: 18px;
            color: #6b7280;
            margin-bottom: 40px;
        }
        
        /* SEARCH BAR */
        .search-container {
            background: white;
            padding: 8px;
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            gap: 10px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .search-input {
            flex: 1;
            padding: 15px 25px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
        }
        
        .search-input:focus {
            outline: none;
        }
        
        .search-btn {
            background: #e22721;
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .search-btn:hover {
            background: #c91f1a;
            transform: scale(1.05);
        }
        
        /* AUTOCOMPLETE */
        .autocomplete-wrapper {
            position: relative;
            flex: 1;
        }
        
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            margin-top: 5px;
        }
        
        .autocomplete-dropdown.show {
            display: block;
        }
        
        .autocomplete-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .autocomplete-item:last-child {
            border-bottom: none;
        }
        
        .autocomplete-item:hover {
            background: #f9fafb;
        }
        
        .autocomplete-item strong {
            color: #e22721;
        }
        
        .autocomplete-item .brand-tag {
            display: inline-block;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
            color: white;
        }
        
        /* VANTAGGI SECTION */
        .vantaggi {
            background: white;
            padding: 60px 0;
        }
        
        .vantaggi-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .vantaggio-card {
            text-align: center;
            padding: 30px 20px;
        }
        
        .vantaggio-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .vantaggio-card h3 {
            font-size: 20px;
            color: #1f2937;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .vantaggio-card p {
            color: #6b7280;
            font-size: 15px;
            line-height: 1.6;
        }
        
        /* MAPPA + FILTRI SECTION */
        .filiali-section {
            background: #f9fafb;
            padding: 60px 0;
        }
        
        .filiali-wrapper {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 30px;
            margin-bottom: 60px;
        }
        
        /* FILTRI SIDEBAR */
        .filtri-sidebar {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            height: fit-content;
            position: sticky;
            top: 100px;
        }
        
        .filtri-sidebar h3 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #1f2937;
        }
        
        .filter-group {
            margin-bottom: 20px;
        }
        
        .filter-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .filter-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .filter-group select:focus {
            outline: none;
            border-color: #e22721;
        }
        
        .risultati-counter {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-top: 20px;
        }
        
        .risultati-counter .number {
            font-size: 28px;
            font-weight: bold;
            color: #e22721;
            display: block;
        }
        
        .risultati-counter .label {
            font-size: 14px;
            color: #6b7280;
        }
        
        /* INFO BOX COMPATTO SIDEBAR */
        .sidebar-info-box {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            margin-top: 20px;
            overflow: hidden;
            display: none;
        }
        
        .sidebar-info-box.show {
            display: block;
            animation: fadeInScale 0.3s ease;
        }
        
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .sidebar-info-header {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            padding: 15px;
            border-bottom: 2px solid #e22721;
        }
        
        .sidebar-info-title {
            font-size: 16px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 5px;
        }
        
        .sidebar-brand-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            color: white;
            margin-top: 5px;
        }
        
        .sidebar-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 8px;
            font-size: 13px;
        }
        
        .sidebar-stars {
            color: #fbbf24;
            font-size: 14px;
        }
        
        .sidebar-rating-num {
            font-weight: 600;
            color: #1f2937;
        }
        
        .sidebar-info-body {
            padding: 15px;
        }
        
        .sidebar-detail {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 10px;
            font-size: 13px;
            color: #4b5563;
        }
        
        .sidebar-detail:last-child {
            margin-bottom: 0;
        }
        
        .sidebar-icon {
            font-size: 14px;
            width: 18px;
            flex-shrink: 0;
        }
        
        .sidebar-detail a {
            color: #2563eb;
            text-decoration: none;
        }
        
        .sidebar-detail a:hover {
            text-decoration: underline;
        }
        
        .sidebar-reviews {
            background: #f9fafb;
            padding: 12px 15px;
            border-top: 1px solid #e5e7eb;
            font-size: 12px;
        }
        
        .sidebar-review-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
        }
        
        .sidebar-review-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 3px solid #fbbf24;
        }
        
        .sidebar-review-item:last-child {
            margin-bottom: 0;
        }
        
        .sidebar-review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .sidebar-review-name {
            font-weight: 600;
            font-size: 12px;
            color: #1f2937;
        }
        
        .sidebar-review-stars {
            color: #fbbf24;
            font-size: 11px;
        }
        
        .sidebar-review-text {
            font-size: 11px;
            color: #6b7280;
            line-height: 1.4;
        }
        
        .sidebar-actions {
            padding: 12px 15px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 8px;
        }
        
        .sidebar-btn {
            flex: 1;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-decoration: none;
            text-align: center;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .sidebar-btn-maps {
            background: #4285f4;
            color: white;
        }
        
        .sidebar-btn-maps:hover {
            background: #3367d6;
        }
        
        .sidebar-btn-contact {
            background: #e22721;
            color: white;
        }
        
        .sidebar-btn-contact:hover {
            background: #c91f1a;
        }
        
        .reset-btn {
            width: 100%;
            padding: 10px;
            background: transparent;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            color: #6b7280;
            font-size: 14px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }
        
        .reset-btn:hover {
            border-color: #e22721;
            color: #e22721;
        }
        
        /* MAPPA ITALIA */
        .mappa-container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            min-height: 500px;
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }
        
        /* LISTA FILIALI NELLA CELLA DESTRA */
        .filiali-list-view {
            width: 100%;
            height: fit-content;
        }
        
        .list-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f3f4f6;
        }
        
        .list-header h3 {
            font-size: 20px;
            color: #1f2937;
            font-weight: 600;
        }
        
        .filiali-cards {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .filiale-card {
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filiale-card:hover {
            border-color: #e22721;
            background: white;
            box-shadow: 0 2px 8px rgba(226, 39, 33, 0.1);
        }
        
        .filiale-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .filiale-card-title {
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 4px;
        }
        
        .filiale-card-brand {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            color: white;
        }
        
        .filiale-card-body {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filiale-card-detail {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #6b7280;
        }
        
        .filiale-card-detail strong {
            color: #1f2937;
            font-weight: 600;
        }
        
        /* BADGE DISTANZA */
        .distanza-badge {
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 12px;
            display: inline-block;
        }
        
        .distanza-badge.vicina {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }
        
        .distanza-badge.normale {
            background: #f3f4f6;
            color: #6b7280;
            border: 2px solid #e5e7eb;
        }
        
        /* DIVISORE */
        .filiali-divider {
            margin: 25px 0 20px;
            text-align: center;
            position: relative;
        }
        
        .filiali-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e5e7eb;
        }
        
        .filiali-divider span {
            background: white;
            padding: 0 15px;
            position: relative;
            color: #6b7280;
            font-size: 14px;
            font-weight: 600;
        }
        
        /* LISTA COMPATTA */
        .filiali-list-compact {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .filiale-compact-item {
            padding: 12px 15px;
            background: #f9fafb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .filiale-compact-item:hover {
            background: #f3f4f6;
            transform: translateX(3px);
        }
        
        .filiale-compact-citta {
            font-weight: 600;
            color: #1f2937;
        }
        
        .filiale-compact-divider {
            color: #d1d5db;
        }
        
        .filiale-compact-distanza {
            color: #6b7280;
            font-weight: 500;
        }
        
        .filiale-compact-brand {
            font-weight: 600;
            font-size: 12px;
        }
        
        /* BOTTONE TORNA AI RISULTATI */
        .back-to-results-btn {
            background: #e22721;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .back-to-results-btn:hover {
            background: #c91f1a;
            transform: translateX(-3px);
        }
        
        .mappa-italia {
            max-width: 100%;
            height: auto;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }
        
        /* LISTA FILIALI */
        /* RECAP FILIALI */
        .filiali-recap {
            margin-top: 60px;
            text-align: center;
        }
        
        .filiali-recap h2 {
            font-size: 36px;
            color: #1f2937;
            margin-bottom: 10px;
        }
        
        .recap-subtitle {
            font-size: 18px;
            color: #6b7280;
            margin-bottom: 50px;
        }
        
        .recap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            text-align: left;
        }
        
        .recap-region {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .recap-region-title {
            font-size: 20px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 5px;
        }
        
        .recap-region-count {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 15px;
        }
        
        .recap-cities {
            font-size: 15px;
            color: #4b5563;
            line-height: 1.8;
        }
        
        .recap-cities span {
            display: inline;
        }
        
        .recap-cities span:not(:last-child)::after {
            content: ' ‚Ä¢ ';
            color: #d1d5db;
        }
        
        .btn-icon {
            padding: 8px 12px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            color: #1f2937;
        }
        
        .btn-icon:hover {
            background: #e5e7eb;
            transform: translateY(-2px);
        }
        
        /* CTA FINALE */
        .cta-finale {
            background: linear-gradient(135deg, #e22721 0%, #c91f1a 100%);
            padding: 60px 0;
            text-align: center;
            color: white;
        }
        
        .cta-finale h2 {
            font-size: 32px;
            margin-bottom: 15px;
        }
        
        .cta-finale p {
            font-size: 18px;
            margin-bottom: 30px;
            opacity: 0.95;
        }
        
        .cta-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .cta-button {
            background: white;
            color: #e22721;
            padding: 15px 35px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        /* FOOTER - Identico homepage */
        footer {
            background: #1f2937;
            color: white;
            padding: 60px 0 30px;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 40px;
            margin-bottom: 40px;
        }
        
        .footer-column h4 {
            font-size: 16px;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        .footer-column ul {
            list-style: none;
        }
        
        .footer-column ul li {
            margin-bottom: 10px;
        }
        
        .footer-column ul li a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s;
        }
        
        .footer-column ul li a:hover {
            color: white;
        }
        
        .footer-bottom {
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 30px;
            text-align: center;
            color: rgba(255,255,255,0.6);
            font-size: 14px;
        }
        
        /* RESPONSIVE */
        @media (max-width: 1024px) {
            .filiali-wrapper {
                grid-template-columns: 1fr;
            }
            
            .filtri-sidebar {
                position: static;
            }
            
            .filiale-row {
                grid-template-columns: 1fr;
                gap: 8px;
                padding: 15px 25px;
            }
            
            .filiale-actions-row {
                justify-content: flex-start;
            }
        }
        
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 32px;
            }
            
            .hero .subtitle {
                font-size: 16px;
            }
            
            .vantaggi-grid {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .filiale-row {
                padding: 15px 20px;
            }
            
            .footer-content {
                grid-template-columns: repeat(2, 1fr);
                gap: 30px;
            }
            
            .nav-links {
                display: none;
            }
        }
        
        /* Animazioni */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .filiale-card {
            animation: fadeIn 0.5s ease forwards;
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header>
        <nav class="container">
            <a href="/" class="logo">ATTAL</a>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/offerte">Cerca Lavoro</a></li>
                <li><a href="/filiali" class="active">Filiali</a></li>
                <li><a href="/aziende">Per Aziende</a></li>
                <li><a href="/contatti">Contatti</a></li>
            </ul>
        </nav>
    </header>

    <!-- HERO SECTION - GEOLOCALIZZAZIONE -->
    <section class="hero">
        <div class="container">
            <h1>Trova la filiale pi√π vicina a te</h1>
            <p class="subtitle">88 sedi in Italia, scopri quella nei tuoi dintorni</p>
            
            <button class="geo-btn" id="geoBtn" onclick="trovaFilialeVicina()">
                <span class="geo-icon">üìç</span>
                <span class="geo-text">Trova filiale vicina</span>
            </button>
            
            <!-- Alert se nessuna filiale vicina -->
            <div class="geo-alert" id="geoAlert" style="display: none;">
                <div class="geo-alert-icon">‚ö†Ô∏è</div>
                <div class="geo-alert-content">
                    <h3>Nessuna filiale nei dintorni immediati</h3>
                    <p>Ma non preoccuparti! Abbiamo <strong>1331 offerte di lavoro</strong> disponibili.</p>
                    <div class="geo-alert-actions">
                        <a href="/offerte" class="geo-alert-btn primary">üîç Cerca offerte vicine</a>
                        <button class="geo-alert-btn secondary" onclick="scrollToManualSearch()">üìç Sfoglia tutte le filiali</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SEZIONE RICERCA MANUALE -->
    <section class="search-section" id="manualSearchSection">
        <div class="container">
            <h2>Oppure cerca manualmente</h2>
            <p class="search-subtitle">Trova la filiale che preferisci per citt√†, regione o brand</p>
            
            <div class="search-container">
                <div class="autocomplete-wrapper">
                    <input type="text" class="search-input" id="searchInput" placeholder="Cerca per citt√†, provincia o CAP..." autocomplete="off">
                    <div class="autocomplete-dropdown" id="autocompleteDropdown"></div>
                </div>
                <button class="search-btn" onclick="filterFiliali()">üîç Cerca</button>
            </div>
        </div>
    </section>

    <!-- MAPPA + FILTRI -->
    <section class="filiali-section">
        <div class="container">
            <div class="filiali-wrapper">
                <!-- SIDEBAR FILTRI -->
                <aside class="filtri-sidebar">
                    <h3>üîç Filtra per</h3>
                    
                    <div class="filter-group">
                        <label>üìç Regione</label>
                        <select id="regioneFilter" onchange="filterFiliali()">
                            <option value="">Tutte le regioni</option>
                            <option value="Lombardia">Lombardia</option>
                            <option value="Lazio">Lazio</option>
                            <option value="Piemonte">Piemonte</option>
                            <option value="Veneto">Veneto</option>
                            <option value="Emilia-Romagna">Emilia-Romagna</option>
                            <option value="Toscana">Toscana</option>
                            <option value="Puglia">Puglia</option>
                            <option value="Campania">Campania</option>
                            <option value="Liguria">Liguria</option>
                            <option value="Marche">Marche</option>
                            <option value="Calabria">Calabria</option>
                            <option value="Sicilia">Sicilia</option>
                            <option value="Sardegna">Sardegna</option>
                            <option value="Abruzzo">Abruzzo</option>
                            <option value="Friuli-Venezia Giulia">Friuli-Venezia Giulia</option>
                            <option value="Umbria">Umbria</option>
                            <option value="Basilicata">Basilicata</option>
                            <option value="Molise">Molise</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>üè¢ Brand</label>
                        <select id="brandFilter" onchange="filterFiliali()">
                            <option value="">Tutti i brand</option>
                            <option value="Temporary">Temporary</option>
                            <option value="Tempor">Tempor</option>
                            <option value="Tempus">Tempus</option>
                            <option value="Lavorint">Lavorint</option>
                        </select>
                    </div>
                    
                    <!-- INFO BOX FILIALE SIDEBAR -->
                    <div class="sidebar-info-box" id="sidebarInfoBox">
                        <div class="sidebar-info-header">
                            <div class="sidebar-info-title" id="sidebarTitle">Seleziona una filiale</div>
                            <span class="sidebar-brand-badge" id="sidebarBrand" style="background: #e22721">-</span>
                            <div class="sidebar-rating">
                                <span class="sidebar-stars" id="sidebarStars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                                <span class="sidebar-rating-num" id="sidebarRating">-</span>
                                <span style="color: #9ca3af; font-size: 11px;" id="sidebarCount">(-)</span>
                            </div>
                        </div>
                        <div class="sidebar-info-body">
                            <div class="sidebar-detail">
                                <span class="sidebar-icon">üìç</span>
                                <span id="sidebarAddress">-</span>
                            </div>
                            <div class="sidebar-detail">
                                <span class="sidebar-icon">‚òé</span>
                                <a href="tel:" id="sidebarPhone">-</a>
                            </div>
                            <div class="sidebar-detail">
                                <span class="sidebar-icon">‚è∞</span>
                                <span>Lun-Ven 9:00-18:00</span>
                            </div>
                        </div>
                        <div class="sidebar-reviews">
                            <div class="sidebar-review-title">üí¨ Recensioni</div>
                            <div id="sidebarReviewsList">
                                <!-- Recensioni generate da JS -->
                            </div>
                        </div>
                        <div class="sidebar-actions">
                            <a href="#" target="_blank" class="sidebar-btn sidebar-btn-maps" id="sidebarMapsBtn">üó∫Ô∏è Maps</a>
                            <a href="/cdn-cgi/l/email-protection#3c" class="sidebar-btn sidebar-btn-contact" id="sidebarContactBtn">‚úâ Email</a>
                        </div>
                    </div>
                    
                    <button class="reset-btn" onclick="resetFilters()">‚Üª Reset filtri</button>
                </aside>

                <!-- CONTENITORE DINAMICO: LISTA O MAPPA -->
                <div class="mappa-container" id="dinamicContainer">
                    <!-- Lista filiali (default) -->
                    <div id="filialiListView" class="filiali-list-view">
                        <div class="list-header">
                            <h3 id="listHeaderTitle">üìç Filiali trovate</h3>
                        </div>
                        <div id="filialiCards" class="filiali-cards">
                            <!-- Cards generate da JS -->
                        </div>
                    </div>
                    
                    <!-- Mappa (nascosta di default) -->
                    <div id="mapViewContainer" style="display: none; width: 100%;">
                        <button class="back-to-results-btn" onclick="showListInRightPanel()">
                            ‚Üê Torna ai risultati
                        </button>
                        <iframe 
                            id="googleMap"
                            width="100%" 
                            height="550" 
                            style="border:0; border-radius: 12px;" 
                            loading="lazy" 
                            allowfullscreen
                            referrerpolicy="no-referrer-when-downgrade"
                            src="">
                        </iframe>
                    </div>
                </div>
            </div>

            <!-- RECAP TUTTE LE FILIALI -->
            <div class="filiali-recap">
                <h2>Tutte le nostre sedi</h2>
                <p class="recap-subtitle">88 filiali distribuite in tutta Italia per essere sempre vicini a te</p>
                <div class="recap-grid" id="filialiRecap">
                    <!-- Generato da JavaScript -->
                </div>
            </div>
        </div>
    </section>

    <!-- VANTAGGI -->
    <section class="vantaggi">
        <div class="container">
            <div class="vantaggi-grid">
                <div class="vantaggio-card">
                    <div class="vantaggio-icon">üë•</div>
                    <h3>Consulenza Gratuita</h3>
                    <p>Parlaci delle tue competenze e aspettative, ti indirizziamo verso le migliori opportunit√†</p>
                </div>
                <div class="vantaggio-card">
                    <div class="vantaggio-icon">‚ö°</div>
                    <h3>Colloquio in Giornata</h3>
                    <p>Vieni senza appuntamento, i nostri consulenti ti ricevono subito per valutare il tuo profilo</p>
                </div>
                <div class="vantaggio-card">
                    <div class="vantaggio-icon">‚úÖ</div>
                    <h3>Ti Chiamiamo in 48h</h3>
                    <p>Lasci il CV e ti richiamiamo entro 2 giorni lavorativi con proposte concrete</p>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA FINALE -->
    <section class="cta-finale">
        <div class="container">
            <h2>üì± Non trovi la tua citt√†?</h2>
            <p>Chiamaci o scrivici, ti aiutiamo noi a trovare la soluzione pi√π vicina</p>
            <div class="cta-buttons">
                <a href="tel:02454320" class="cta-button">
                    ‚òé 02/454320
                </a>
                <a href="/cdn-cgi/l/email-protection#eb82858d84ab8a9f9f8a878c99849e9bc5829f" class="cta-button">
                    ‚úâ <span class="__cf_email__" data-cfemail="fd94939b92bd9c89899c919a8f92888dd39489">[email&#160;protected]</span>
                </a>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h4>ATTAL Group</h4>
                    <ul>
                        <li><a href="/chi-siamo">Chi Siamo</a></li>
                        <li><a href="/servizi">Servizi</a></li>
                        <li><a href="/filiali">Le Nostre Filiali</a></li>
                        <li><a href="/contatti">Contatti</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Per Candidati</h4>
                    <ul>
                        <li><a href="/offerte">Offerte di Lavoro</a></li>
                        <li><a href="/come-funziona">Come Funziona</a></li>
                        <li><a href="/candidati/registrati">Registrati</a></li>
                        <li><a href="/candidati/area-riservata">Area Riservata</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Per Aziende</h4>
                    <ul>
                        <li><a href="/aziende/servizi">I Nostri Servizi</a></li>
                        <li><a href="/aziende/preventivo">Richiedi Preventivo</a></li>
                        <li><a href="/aziende/area-clienti">Area Clienti</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>I Nostri Brand</h4>
                    <ul>
                        <li>Temporary</li>
                        <li>Lavorint</li>
                        <li>Tempus</li>
                        <li>Tempor</li>
                        <li>Abea</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>¬© 2024 ATTAL Group - Tutti i diritti riservati - Aut. Min. Prot 0013582 - 03/10/2012 - P.IVA 06961760722</p>
            </div>
        </div>
    </footer>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // Database completo filiali (88 totali)
        const filiali = [
            // TEMPUS (17 filiali)
            { citta: "Acqui Terme", brand: "Tempus", regione: "Piemonte", indirizzo: "Via Roma 45", tel: "0144/322456", email: "acqui@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 44.6753, lng: 8.4711 },
            { citta: "Albenga", brand: "Tempus", regione: "Liguria", indirizzo: "Corso Italia 23", tel: "0182/543210", email: "albenga@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 44.0495, lng: 8.2113 },
            { citta: "Alessandria", brand: "Tempus", regione: "Piemonte", indirizzo: "Via Milano 67", tel: "0131/234567", email: "alessandria@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 44.9134, lng: 8.6153 },
            { citta: "Bassano del Grappa", brand: "Tempus", regione: "Veneto", indirizzo: "Via Jacopo da Ponte 12", tel: "0424/523456", email: "bassano@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 45.7664, lng: 11.7314 },
            { citta: "Cinisello Balsamo", brand: "Tempus", regione: "Lombardia", indirizzo: "Viale Fulvio Testi 128", tel: "02/66014523", email: "cinisello@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 45.5579, lng: 9.2170 },
            { citta: "Cornaredo", brand: "Tempus", regione: "Lombardia", indirizzo: "Via Magenta 18", tel: "02/93666789", email: "cornaredo@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 45.4985, lng: 8.9458 },
            { citta: "Erba", brand: "Tempus", regione: "Lombardia", indirizzo: "Via Como 34", tel: "031/645678", email: "erba@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 45.8112, lng: 9.2291 },
            { citta: "Fabriano", brand: "Tempus", regione: "Marche", indirizzo: "Piazza del Comune 8", tel: "0732/625789", email: "fabriano@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 43.3357, lng: 12.9045 },
            { citta: "Firenze", brand: "Tempus", regione: "Toscana", indirizzo: "Via Cavour 52", tel: "055/2345678", email: "firenze@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 43.7696, lng: 11.2558 },
            { citta: "Gallarate", brand: "Tempus", regione: "Lombardia", indirizzo: "Corso Italia 89", tel: "0331/776543", email: "gallarate@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 45.6587, lng: 8.7914 },
            { citta: "Lainate", brand: "Tempus", regione: "Lombardia", indirizzo: "Via Milano 156", tel: "02/93570123", email: "lainate@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 45.5705, lng: 9.0247 },
            { citta: "Latina", brand: "Tempus", regione: "Lazio", indirizzo: "Corso della Repubblica 45", tel: "0773/662345", email: "latina@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 41.4677, lng: 12.9036 },
            { citta: "Lecco", brand: "Tempus", regione: "Lombardia", indirizzo: "Via Amendola 32", tel: "0341/363456", email: "lecco@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 45.8567, lng: 9.3988 },
            { citta: "Merate", brand: "Tempus", regione: "Lombardia", indirizzo: "Piazza Prinetti 5", tel: "039/9902345", email: "merate@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 45.6948, lng: 9.4233 },
            { citta: "Pomezia", brand: "Tempus", regione: "Lazio", indirizzo: "Via Pontina Vecchia 78", tel: "06/91195678", email: "pomezia@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 41.6689, lng: 12.5009 },
            { citta: "Verona", brand: "Tempus", regione: "Veneto", indirizzo: "Via Leoncino 23", tel: "045/8001234", email: "verona@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 45.4384, lng: 10.9916 },
            { citta: "Vigevano", brand: "Tempus", regione: "Lombardia", indirizzo: "Corso Cavour 67", tel: "0381/74523", email: "vigevano@tempusitalia.it", orari: "Lun-Ven 9:00-18:00", lat: 45.3143, lng: 8.8545 },
            
            // TEMPORARY (20 filiali)
            { citta: "Bari", brand: "Temporary", regione: "Puglia", indirizzo: "Via Sparano 128", tel: "080/5211234", email: "bari@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 41.1171, lng: 16.8719 },
            { citta: "Battipaglia", brand: "Temporary", regione: "Campania", indirizzo: "Via Roma 45", tel: "0828/301234", email: "battipaglia@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 40.6102, lng: 14.9819 },
            { citta: "Bergamo", brand: "Temporary", regione: "Lombardia", indirizzo: "Via XX Settembre 78", tel: "035/237890", email: "bergamo@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 45.6983, lng: 9.6773 },
            { citta: "Brescia", brand: "Temporary", regione: "Lombardia", indirizzo: "Corso Zanardelli 34", tel: "030/2929345", email: "brescia@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 45.5416, lng: 10.2118 },
            { citta: "Cuneo", brand: "Temporary", regione: "Piemonte", indirizzo: "Via Roma 12", tel: "0171/693456", email: "cuneo@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 44.3841, lng: 7.5426 },
            { citta: "Frosinone", brand: "Temporary", regione: "Lazio", indirizzo: "Viale Roma 234", tel: "0775/270123", email: "frosinone@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 41.6401, lng: 13.3403 },
            { citta: "Lecce", brand: "Temporary", regione: "Puglia", indirizzo: "Via Palmieri 67", tel: "0832/241234", email: "lecce@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 40.3515, lng: 18.1750 },
            { citta: "Lodi", brand: "Temporary", regione: "Lombardia", indirizzo: "Corso Umberto I 23", tel: "0371/421345", email: "lodi@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 45.3141, lng: 9.5034 },
            { citta: "Mestre", brand: "Temporary", regione: "Veneto", indirizzo: "Via Piave 45", tel: "041/951234", email: "mestre@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 45.4895, lng: 12.2422 },
            { citta: "Milano Corsica", brand: "Temporary", regione: "Lombardia", indirizzo: "Via Pergolesi 8", tel: "02/454320", email: "milano.corsica@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 45.4773, lng: 9.2066 },
            { citta: "Milano Navigli", brand: "Temporary", regione: "Lombardia", indirizzo: "Ripa di Porta Ticinese 55", tel: "02/89401234", email: "milano.navigli@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 45.4485, lng: 9.1779 },
            { citta: "Milano Lecco", brand: "Temporary", regione: "Lombardia", indirizzo: "Via Lecco 23", tel: "02/26826789", email: "milano.lecco@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 45.4926, lng: 9.2167 },
            { citta: "Milano Monza", brand: "Temporary", regione: "Lombardia", indirizzo: "Viale Monza 140", tel: "02/26410345", email: "milano.monza@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 45.5032, lng: 9.2235 },
            { citta: "Novara", brand: "Temporary", regione: "Piemonte", indirizzo: "Corso Cavour 12", tel: "0321/623456", email: "novara@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 45.4469, lng: 8.6218 },
            { citta: "Palermo", brand: "Temporary", regione: "Sicilia", indirizzo: "Via Libert√† 189", tel: "091/6251234", email: "palermo@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 38.1157, lng: 13.3615 },
            { citta: "Pavia", brand: "Temporary", regione: "Lombardia", indirizzo: "Corso Cavour 34", tel: "0382/530123", email: "pavia@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 45.1847, lng: 9.1582 },
            { citta: "Piacenza", brand: "Temporary", regione: "Emilia-Romagna", indirizzo: "Via Roma 67", tel: "0523/334567", email: "piacenza@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 45.0526, lng: 9.6929 },
            { citta: "Torino", brand: "Temporary", regione: "Piemonte", indirizzo: "Via Giolitti 24/B", tel: "011/7640242", email: "torino@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 45.0703, lng: 7.6869 },
            { citta: "Voghera", brand: "Temporary", regione: "Lombardia", indirizzo: "Via Emilia 89", tel: "0383/368901", email: "voghera@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 44.9938, lng: 9.0096 },
            { citta: "Genova", brand: "Temporary", regione: "Liguria", indirizzo: "Via XX Settembre 41", tel: "010/5701234", email: "genova@temporary.it", orari: "Lun-Ven 9:00-18:00", lat: 44.4056, lng: 8.9463 },
            
            // TEMPOR (22 filiali)
            { citta: "Bergamo", brand: "Tempor", regione: "Lombardia", indirizzo: "Via Nazario Sauro 2/D", tel: "035/249752", email: "temporbergamo@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 45.6983, lng: 9.6773 },
            { citta: "Bologna", brand: "Tempor", regione: "Emilia-Romagna", indirizzo: "Via Leonetto Cipriani 13", tel: "051/6810640", email: "temporbologna@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 44.4949, lng: 11.3426 },
            { citta: "Cagliari", brand: "Tempor", regione: "Sardegna", indirizzo: "Viale Bonaria 56", tel: "070/3328707", email: "tempor.cagliari@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 39.2238, lng: 9.1217 },
            { citta: "Codroipo", brand: "Tempor", regione: "Friuli-Venezia Giulia", indirizzo: "Via Candotti 4", tel: "0432/1903230", email: "temporfvg@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 45.9619, lng: 12.9809 },
            { citta: "Cosenza", brand: "Tempor", regione: "Calabria", indirizzo: "Via Pasquale Rossi 49", tel: "0984/414774", email: "temporcosenza@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 39.2990, lng: 16.2518 },
            { citta: "Crema", brand: "Tempor", regione: "Lombardia", indirizzo: "Via Cadorna 22", tel: "0373/476074", email: "temporcrema@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 45.3625, lng: 9.6853 },
            { citta: "Frosinone", brand: "Tempor", regione: "Lazio", indirizzo: "Via Licinio Refice 24", tel: "0775/271112", email: "temporfrosinone@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 41.6401, lng: 13.3403 },
            { citta: "Ivrea", brand: "Tempor", regione: "Piemonte", indirizzo: "Via Natalia Ginzburg 3/A", tel: "0125/642832", email: "temporivrea@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 45.4669, lng: 7.8754 },
            { citta: "Latina", brand: "Tempor", regione: "Lazio", indirizzo: "Via Piave 829", tel: "0773/474268", email: "temporlatina@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 41.4677, lng: 12.9036 },
            { citta: "La Spezia", brand: "Tempor", regione: "Liguria", indirizzo: "Via Giacomo Doria 53", tel: "0187/1866645", email: "temporlaspezia@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 44.1025, lng: 9.8247 },
            { citta: "Lecce", brand: "Tempor", regione: "Puglia", indirizzo: "Via Manzoni 32/d", tel: "0832/279967", email: "temporlecce@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 40.3515, lng: 18.1750 },
            { citta: "Melfi", brand: "Tempor", regione: "Basilicata", indirizzo: "Viale Aldo Moro 22", tel: "0972/086323", email: "tempormelfi@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 40.9959, lng: 15.6533 },
            { citta: "Modena", brand: "Tempor", regione: "Emilia-Romagna", indirizzo: "Via Divisione Acqui 137/b", tel: "059/370766", email: "tempormodena@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 44.6471, lng: 10.9252 },
            { citta: "Olbia", brand: "Tempor", regione: "Sardegna", indirizzo: "Via Capotesta 1/50", tel: "345/8857504", email: "temporolbia@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 40.9216, lng: 9.4959 },
            { citta: "Parma", brand: "Tempor", regione: "Emilia-Romagna", indirizzo: "Via Giovanni Lanfranco 9", tel: "0521/982777", email: "temporparma@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 44.8015, lng: 10.3279 },
            { citta: "Potenza", brand: "Tempor", regione: "Basilicata", indirizzo: "Corso Garibaldi 82", tel: "0971/274736", email: "temporpotenza@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 40.6389, lng: 15.8054 },
            { citta: "Rieti", brand: "Tempor", regione: "Lazio", indirizzo: "Piazza Vittorio Bachelet 27", tel: "0746/1973227", email: "temporrieti@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 42.4041, lng: 12.8565 },
            { citta: "Roma", brand: "Tempor", regione: "Lazio", indirizzo: "Via Livorno 41/B", tel: "06/77208232", email: "tempor.roma@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 41.9028, lng: 12.4964 },
            { citta: "Salerno", brand: "Tempor", regione: "Campania", indirizzo: "Via S. Leonardo 52", tel: "089/2851172", email: "temporsalerno@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 40.6824, lng: 14.7681 },
            { citta: "Thiene", brand: "Tempor", regione: "Veneto", indirizzo: "Viale Europa 95", tel: "0445/1650997", email: "temporthiene@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 45.7080, lng: 11.4781 },
            { citta: "Torino", brand: "Tempor", regione: "Piemonte", indirizzo: "Via Susa 40", tel: "011/5069446", email: "tempor.torino@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 45.0703, lng: 7.6869 },
            { citta: "Vasto", brand: "Tempor", regione: "Abruzzo", indirizzo: "Via Maddalena 63/b", tel: "0873/471100", email: "temporvasto@tempor.it", orari: "Lun-Ven 9:00-18:00", lat: 42.1114, lng: 14.7078 },
            
            // LAVORINT (29 filiali)
            { citta: "Ancona", brand: "Lavorint", regione: "Marche", indirizzo: "Via Marconi 45", tel: "071/2071234", email: "ancona@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 43.6158, lng: 13.5189 },
            { citta: "Ascoli Piceno", brand: "Lavorint", regione: "Marche", indirizzo: "Corso Mazzini 78", tel: "0736/253456", email: "ascoli@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 42.8534, lng: 13.5759 },
            { citta: "Avellino", brand: "Lavorint", regione: "Campania", indirizzo: "Corso Vittorio Emanuele II 101", tel: "0825/36789", email: "avellino@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 40.9142, lng: 14.7906 },
            { citta: "Bari", brand: "Lavorint", regione: "Puglia", indirizzo: "Via Dante 134", tel: "080/5242345", email: "bari@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 41.1171, lng: 16.8719 },
            { citta: "Bergamo", brand: "Lavorint", regione: "Lombardia", indirizzo: "Via Paleocapa 23", tel: "035/242567", email: "bergamo@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 45.6983, lng: 9.6773 },
            { citta: "Biella", brand: "Lavorint", regione: "Piemonte", indirizzo: "Via Italia 56", tel: "015/8492345", email: "biella@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 45.5629, lng: 8.0580 },
            { citta: "Bologna", brand: "Lavorint", regione: "Emilia-Romagna", indirizzo: "Via Rizzoli 12", tel: "051/236789", email: "bologna@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 44.4949, lng: 11.3426 },
            { citta: "Bra", brand: "Lavorint", regione: "Piemonte", indirizzo: "Via Vittorio Emanuele 34", tel: "0172/413456", email: "bra@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 44.6979, lng: 7.8555 },
            { citta: "Campobasso", brand: "Lavorint", regione: "Molise", indirizzo: "Corso Vittorio Emanuele 89", tel: "0874/91234", email: "campobasso@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 41.5630, lng: 14.6569 },
            { citta: "Canosa di Puglia", brand: "Lavorint", regione: "Puglia", indirizzo: "Via Roma 23", tel: "0883/661234", email: "canosa@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 41.2229, lng: 16.0653 },
            { citta: "Carrara", brand: "Lavorint", regione: "Toscana", indirizzo: "Viale XX Settembre 45", tel: "0585/71234", email: "carrara@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 44.0810, lng: 10.0970 },
            { citta: "Fidenza", brand: "Lavorint", regione: "Emilia-Romagna", indirizzo: "Via Berenini 12", tel: "0524/523456", email: "fidenza@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 44.8665, lng: 10.0632 },
            { citta: "Foligno", brand: "Lavorint", regione: "Umbria", indirizzo: "Via Mazzini 67", tel: "0742/340123", email: "foligno@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 42.9565, lng: 12.7035 },
            { citta: "Genova", brand: "Lavorint", regione: "Liguria", indirizzo: "Via Fiume 34", tel: "010/5461234", email: "genova@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 44.4056, lng: 8.9463 },
            { citta: "Mantova", brand: "Lavorint", regione: "Lombardia", indirizzo: "Corso Vittorio Emanuele 45", tel: "0376/323456", email: "mantova@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 45.1564, lng: 10.7914 },
            { citta: "Modena", brand: "Lavorint", regione: "Emilia-Romagna", indirizzo: "Via Emilia Centro 78", tel: "059/222345", email: "modena@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 44.6471, lng: 10.9252 },
            { citta: "Monselice", brand: "Lavorint", regione: "Veneto", indirizzo: "Via San Marco 23", tel: "0429/73456", email: "monselice@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 45.2405, lng: 11.7505 },
            { citta: "Montecassiano", brand: "Lavorint", regione: "Marche", indirizzo: "Via Roma 12", tel: "0733/598123", email: "montecassiano@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 43.3588, lng: 13.4368 },
            { citta: "Monza", brand: "Lavorint", regione: "Lombardia", indirizzo: "Via Eva Segre 3", tel: "039/2303456", email: "monza@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 45.5845, lng: 9.2744 },
            { citta: "Napoli", brand: "Lavorint", regione: "Campania", indirizzo: "Via Toledo 256", tel: "081/5521234", email: "napoli@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 40.8518, lng: 14.2681 },
            { citta: "Padova", brand: "Lavorint", regione: "Veneto", indirizzo: "Via Roma 89", tel: "049/8761234", email: "padova@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 45.4064, lng: 11.8768 },
            { citta: "Parma", brand: "Lavorint", regione: "Emilia-Romagna", indirizzo: "Via della Repubblica 56", tel: "0521/234567", email: "parma@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 44.8015, lng: 10.3279 },
            { citta: "Perugia", brand: "Lavorint", regione: "Umbria", indirizzo: "Corso Vannucci 34", tel: "075/5721234", email: "perugia@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 43.1107, lng: 12.3908 },
            { citta: "Pescara", brand: "Lavorint", regione: "Abruzzo", indirizzo: "Corso Umberto 123", tel: "085/4211234", email: "pescara@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 42.4618, lng: 14.2158 },
            { citta: "Piombino", brand: "Lavorint", regione: "Toscana", indirizzo: "Via Roma 45", tel: "0565/221234", email: "piombino@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 42.9259, lng: 10.5267 },
            { citta: "Reggio Emilia", brand: "Lavorint", regione: "Emilia-Romagna", indirizzo: "Via Emilia San Pietro 67", tel: "0522/431234", email: "reggio@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 44.6989, lng: 10.6297 },
            { citta: "Roma", brand: "Lavorint", regione: "Lazio", indirizzo: "Via Nazionale 243", tel: "06/47821234", email: "roma@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 41.9028, lng: 12.4964 },
            { citta: "Teramo", brand: "Lavorint", regione: "Abruzzo", indirizzo: "Corso San Giorgio 78", tel: "0861/241234", email: "teramo@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 42.6589, lng: 13.7040 },
            { citta: "Torino", brand: "Lavorint", regione: "Piemonte", indirizzo: "Via Garibaldi 45", tel: "011/5621234", email: "torino@lavorint.it", orari: "Lun-Ven 9:00-18:00", lat: 45.0703, lng: 7.6869 }
        ];

        let filialiFiltered = [...filiali];
        
        // Brand colors
        const brandColors = {
            'Lavorint': '#06b6d4',
            'Tempus': '#2563eb',
            'Temporary': '#f97316',
            'Tempor': '#991b1b'
        };
        
        // Recensioni template
        const recensioniTemplate = [
            { nome: "Marco R.", testo: "Professionali e veloci. Trovato lavoro in 3 giorni!", stelle: 5 },
            { nome: "Laura B.", testo: "Consulenti preparati, mi hanno seguito fino all'assunzione.", stelle: 5 },
            { nome: "Giuseppe M.", testo: "Finalmente un'agenzia seria! Consigliatissimi!", stelle: 5 },
            { nome: "Francesca T.", testo: "Personale cordiale e competente. Ottima esperienza.", stelle: 5 },
            { nome: "Alessandro P.", testo: "Mi hanno aiutato a trovare il lavoro perfetto!", stelle: 5 },
            { nome: "Chiara S.", testo: "Ambiente accogliente, consulenti top.", stelle: 4 },
            { nome: "Roberto V.", testo: "Esperienza positiva. Buona assistenza.", stelle: 4 },
            { nome: "Simona L.", testo: "Finalmente ho trovato stabilit√† lavorativa!", stelle: 5 }
        ];
        
        // GEOLOCALIZZAZIONE MOCKUP
        // Posizione simulata: Milano centro
        const MOCK_POSITION = {
            lat: 45.4642,
            lng: 9.1900
        };
        
        // Formula Haversine per calcolare distanza in km tra due coordinate
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Raggio Terra in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }
        
        // Trova filiale pi√π vicina
        function trovaFilialeVicina() {
            const btn = document.getElementById('geoBtn');
            const alert = document.getElementById('geoAlert');
            
            // Animazione loading
            btn.classList.add('loading');
            btn.querySelector('.geo-text').textContent = 'Rilevamento posizione';
            
            setTimeout(() => {
                // Calcola distanze da Milano
                const filialiConDistanza = filiali.map(f => {
                    if (f.lat && f.lng) {
                        const distanza = calculateDistance(
                            MOCK_POSITION.lat, 
                            MOCK_POSITION.lng, 
                            f.lat, 
                            f.lng
                        );
                        return { ...f, distanza: distanza };
                    }
                    return { ...f, distanza: 9999 };
                });
                
                // Ordina per distanza
                filialiConDistanza.sort((a, b) => a.distanza - b.distanza);
                
                // Prendi le 10 pi√π vicine
                const filialiVicine = filialiConDistanza.slice(0, 10);
                
                // Check se almeno una entro 10km
                const hasFilialeVicina = filialiVicine[0].distanza <= 10;
                
                if (hasFilialeVicina) {
                    // Mostra filiali vicine nella lista
                    filialiFiltered = filialiVicine;
                    generateFilialiCardsWithDistance();
                    
                    // Scroll alla sezione risultati
                    document.querySelector('.filiali-section').scrollIntoView({ 
                        behavior: 'smooth' 
                    });
                    
                    alert.style.display = 'none';
                } else {
                    // Mostra alert nessuna filiale vicina
                    alert.style.display = 'flex';
                }
                
                // Reset bottone
                btn.classList.remove('loading');
                btn.querySelector('.geo-text').textContent = 'Trova filiale vicina';
            }, 800);
        }
        
        // Genera cards con badge distanza (top 3) + lista compatta resto
        function generateFilialiCardsWithDistance() {
            const container = document.getElementById('filialiCards');
            const headerTitle = document.getElementById('listHeaderTitle');
            
            if (filialiFiltered.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #9ca3af; padding: 40px 0;">Nessuna filiale trovata</p>';
                headerTitle.textContent = 'üìç Nessuna filiale trovata';
                return;
            }
            
            // Aggiorna titolo con count
            headerTitle.textContent = `üìç ${filialiFiltered.length} ${filialiFiltered.length === 1 ? 'filiale trovata' : 'filiali trovate'}`;
            
            // Top 3 come card complete
            const top3 = filialiFiltered.slice(0, 3);
            const resto = filialiFiltered.slice(3);
            
            let html = '';
            
            // TOP 3 CARDS
            html += top3.map(f => {
                const filialeJson = JSON.stringify(f).replace(/"/g, '&quot;');
                const distanzaBadge = f.distanza && f.distanza < 9999 ? 
                    (f.distanza <= 10 ? 
                        `<div class="distanza-badge vicina">üéØ A soli ${f.distanza.toFixed(1)} km da te</div>` :
                        `<div class="distanza-badge normale">üìç ${f.distanza.toFixed(1)} km da te</div>`
                    ) : '';
                
                return `
                    <div class="filiale-card" onclick='selectFiliale(${filialeJson})'>
                        ${distanzaBadge}
                        <div class="filiale-card-header">
                            <div>
                                <div class="filiale-card-title">${f.citta}</div>
                                <span class="filiale-card-brand" style="background: ${brandColors[f.brand]}">${f.brand}</span>
                            </div>
                        </div>
                        <div class="filiale-card-body">
                            <div class="filiale-card-detail">
                                üìç <strong>${f.indirizzo}</strong>
                            </div>
                            <div class="filiale-card-detail">
                                ‚òé <strong>${f.tel}</strong>
                            </div>
                            <div class="filiale-card-detail">
                                ‚è∞ Lun-Ven 9:00-18:00
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // DIVISORE + LISTA COMPATTA
            if (resto.length > 0) {
                html += `
                    <div class="filiali-divider">
                        <span>Altre filiali nelle vicinanze</span>
                    </div>
                    <div class="filiali-list-compact">
                        ${resto.map(f => {
                            const filialeJson = JSON.stringify(f).replace(/"/g, '&quot;');
                            const distanzaText = f.distanza && f.distanza < 9999 ? `${f.distanza.toFixed(1)} km` : '-';
                            return `
                                <div class="filiale-compact-item" onclick='selectFiliale(${filialeJson})'>
                                    <span class="filiale-compact-citta">${f.citta}</span>
                                    <span class="filiale-compact-divider">‚Ä¢</span>
                                    <span class="filiale-compact-distanza">${distanzaText}</span>
                                    <span class="filiale-compact-divider">‚Ä¢</span>
                                    <span class="filiale-compact-brand" style="color: ${brandColors[f.brand]}">${f.brand}</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        // Scroll alla ricerca manuale
        function scrollToManualSearch() {
            document.getElementById('manualSearchSection').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }
        
        // Mostra info filiale nella sidebar
        function showFilialeInfo(filiale) {
            const infoBox = document.getElementById('sidebarInfoBox');
            
            // Genera dati realistici
            const rating = (4.2 + Math.random() * 0.6).toFixed(1);
            const reviewCount = Math.floor(80 + Math.random() * 150);
            const fullStars = Math.floor(parseFloat(rating));
            const stars = '‚òÖ'.repeat(fullStars) + '‚òÜ'.repeat(5 - fullStars);
            
            // Scegli 2 recensioni random
            const shuffled = [...recensioniTemplate].sort(() => 0.5 - Math.random());
            const selectedReviews = shuffled.slice(0, 2);
            
            // Aggiorna contenuti
            document.getElementById('sidebarTitle').textContent = filiale.citta;
            document.getElementById('sidebarBrand').textContent = filiale.brand;
            document.getElementById('sidebarBrand').style.background = brandColors[filiale.brand];
            
            // Cambia colore header in base al brand
            const headerElement = document.querySelector('.sidebar-info-header');
            const brandColor = brandColors[filiale.brand];
            
            // Genera gradient light in base al colore brand
            const lightColors = {
                '#e22721': 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)', // Temporary - rosso
                '#06b6d4': 'linear-gradient(135deg, #cffafe 0%, #a5f3fc 100%)', // Lavorint - cyan
                '#8b5cf6': 'linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%)', // Tempus - viola
                '#f97316': 'linear-gradient(135deg, #fed7aa 0%, #fdba74 100%)'  // Tempor - arancione
            };
            
            headerElement.style.background = lightColors[brandColor] || lightColors['#e22721'];
            headerElement.style.borderBottomColor = brandColor;
            
            document.getElementById('sidebarStars').textContent = stars;
            document.getElementById('sidebarRating').textContent = rating;
            document.getElementById('sidebarCount').textContent = `(${reviewCount})`;
            document.getElementById('sidebarAddress').textContent = filiale.indirizzo;
            document.getElementById('sidebarPhone').href = `tel:${filiale.tel.replace(/\//g, '')}`;
            document.getElementById('sidebarPhone').textContent = filiale.tel;
            
            // Genera recensioni HTML
            const reviewsHTML = selectedReviews.map(r => `
                <div class="sidebar-review-item">
                    <div class="sidebar-review-header">
                        <span class="sidebar-review-name">${r.nome}</span>
                        <span class="sidebar-review-stars">${'‚òÖ'.repeat(r.stelle)}${'‚òÜ'.repeat(5-r.stelle)}</span>
                    </div>
                    <div class="sidebar-review-text">"${r.testo}"</div>
                </div>
            `).join('');
            
            document.getElementById('sidebarReviewsList').innerHTML = reviewsHTML;
            
            // Update link e azione Maps
            const mapsQuery = encodeURIComponent(`${filiale.indirizzo}, ${filiale.citta}`);
            const mapsBtn = document.getElementById('sidebarMapsBtn');
            mapsBtn.href = '#';
            mapsBtn.onclick = (e) => {
                e.preventDefault();
                showMapInRightPanel(filiale);
            };
            document.getElementById('sidebarContactBtn').href = `mailto:${filiale.email}`;
            
            // Mostra box
            infoBox.classList.add('show');
            
            // Aggiorna mappa - zoom sulla filiale
            if (filiale.lat && filiale.lng) {
                const iframe = document.getElementById('googleMap');
                iframe.src = `https://www.google.com/maps/embed/v1/view?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&center=${filiale.lat},${filiale.lng}&zoom=15&maptype=roadmap`;
            }
        }

        // AUTOCOMPLETE
        function setupAutocomplete() {
            const input = document.getElementById('searchInput');
            const dropdown = document.getElementById('autocompleteDropdown');
            
            input.addEventListener('input', (e) => {
                const value = e.target.value.toLowerCase().trim();
                
                if (value.length < 2) {
                    dropdown.classList.remove('show');
                    return;
                }
                
                // Trova citt√† che matchano
                const matches = filiali.filter(f => 
                    f.citta.toLowerCase().includes(value)
                ).slice(0, 8); // Max 8 suggerimenti
                
                if (matches.length === 0) {
                    dropdown.classList.remove('show');
                    return;
                }
                
                // Genera dropdown
                dropdown.innerHTML = matches.map(f => {
                    const highlighted = f.citta.replace(
                        new RegExp(value, 'gi'),
                        match => `<strong>${match}</strong>`
                    );
                    return `
                        <div class="autocomplete-item" onclick="selectCity('${f.citta}')">
                            ${highlighted}
                            <span class="brand-tag" style="background: ${brandColors[f.brand]}">${f.brand}</span>
                        </div>
                    `;
                }).join('');
                
                dropdown.classList.add('show');
            });
            
            // Chiudi dropdown al click fuori
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.autocomplete-wrapper')) {
                    dropdown.classList.remove('show');
                }
            });
        }
        
        function selectCity(citta) {
            document.getElementById('searchInput').value = citta;
            document.getElementById('autocompleteDropdown').classList.remove('show');
            
            // Trova la filiale e mostra info box subito
            const filiale = filiali.find(f => f.citta === citta);
            if (filiale) {
                showFilialeInfo(filiale);
            }
            
            filterFiliali();
        }

        // GENERA ACCORDION PER REGIONI
        function generateRecap() {
            const container = document.getElementById('filialiRecap');
            
            // Raggruppa tutte le filiali per regione
            const regioniMap = {};
            filiali.forEach(f => {
                if (!regioniMap[f.regione]) {
                    regioniMap[f.regione] = [];
                }
                regioniMap[f.regione].push(f.citta);
            });
            
            // Ordina regioni alfabeticamente
            const regioni = Object.keys(regioniMap).sort();
            
            container.innerHTML = regioni.map(regione => {
                const citta = [...new Set(regioniMap[regione])].sort(); // Rimuovi duplicati e ordina
                const count = citta.length;
                
                return `
                    <div class="recap-region">
                        <div class="recap-region-title">${regione}</div>
                        <div class="recap-region-count">${count} ${count === 1 ? 'filiale' : 'filiali'}</div>
                        <div class="recap-cities">
                            ${citta.map(c => `<span>${c}</span>`).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // GENERA CARDS FILIALI NELLA CELLA DESTRA
        function generateFilialiCards() {
            const container = document.getElementById('filialiCards');
            const headerTitle = document.getElementById('listHeaderTitle');
            
            if (filialiFiltered.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #9ca3af; padding: 40px 0;">Nessuna filiale trovata</p>';
                headerTitle.textContent = 'üìç Nessuna filiale trovata';
                return;
            }
            
            // Aggiorna titolo con count
            headerTitle.textContent = `üìç ${filialiFiltered.length} ${filialiFiltered.length === 1 ? 'filiale trovata' : 'filiali trovate'}`;
            
            container.innerHTML = filialiFiltered.map(f => {
                const filialeJson = JSON.stringify(f).replace(/"/g, '&quot;');
                return `
                    <div class="filiale-card" onclick='selectFiliale(${filialeJson})'>
                        <div class="filiale-card-header">
                            <div>
                                <div class="filiale-card-title">${f.citta}</div>
                                <span class="filiale-card-brand" style="background: ${brandColors[f.brand]}">${f.brand}</span>
                            </div>
                        </div>
                        <div class="filiale-card-body">
                            <div class="filiale-card-detail">
                                üìç <strong>${f.indirizzo}</strong>
                            </div>
                            <div class="filiale-card-detail">
                                ‚òé <strong>${f.tel}</strong>
                            </div>
                            <div class="filiale-card-detail">
                                ‚è∞ Lun-Ven 9:00-18:00
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // SELEZIONA FILIALE E MOSTRA INFO
        function selectFiliale(filiale) {
            showFilialeInfo(filiale);
        }
        
        // MOSTRA MAPPA NELLA CELLA DESTRA
        function showMapInRightPanel(filiale) {
            const listView = document.getElementById('filialiListView');
            const mapContainer = document.getElementById('mapViewContainer');
            const mapIframe = document.getElementById('googleMap');
            
            // Nascondi lista, mostra mappa con bottone
            listView.style.display = 'none';
            mapContainer.style.display = 'block';
            
            // Carica mappa con indicazioni
            const mapsQuery = encodeURIComponent(`${filiale.indirizzo}, ${filiale.citta}`);
            mapIframe.src = `https://www.google.com/maps/embed/v1/place?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&q=${mapsQuery}&zoom=15`;
        }
        
        // TORNA ALLA LISTA (chiamata quando si fa una nuova ricerca)
        function showListInRightPanel() {
            const listView = document.getElementById('filialiListView');
            const mapContainer = document.getElementById('mapViewContainer');
            
            listView.style.display = 'block';
            mapContainer.style.display = 'none';
        }

        // FILTRA FILIALI
        function filterFiliali() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const regioneFilter = document.getElementById('regioneFilter').value;
            const brandFilter = document.getElementById('brandFilter').value;
            
            filialiFiltered = filiali.filter(filiale => {
                const matchSearch = !searchText || 
                    filiale.citta.toLowerCase().includes(searchText) ||
                    filiale.indirizzo.toLowerCase().includes(searchText);
                
                const matchRegione = !regioneFilter || filiale.regione === regioneFilter;
                const matchBrand = !brandFilter || filiale.brand === brandFilter;
                
                return matchSearch && matchRegione && matchBrand;
            });
            
            generateFilialiCards(); // Genera lista nella cella destra
            showListInRightPanel(); // Torna alla lista se stava vedendo mappa
        }

        // RESET FILTRI
        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('regioneFilter').value = '';
            document.getElementById('brandFilter').value = '';
            filialiFiltered = [...filiali];
            generateFilialiCards();
            updateGoogleMap();
        }
        
        // UPDATE GOOGLE MAP
        function updateGoogleMap() {
            // Calcola centro mappa basato su filiali filtrate
            if (filialiFiltered.length === 0) return;
            
            const avgLat = filialiFiltered.reduce((sum, f) => sum + f.lat, 0) / filialiFiltered.length;
            const avgLng = filialiFiltered.reduce((sum, f) => sum + f.lng, 0) / filialiFiltered.length;
            
            const zoom = filialiFiltered.length === 1 ? 13 : (filialiFiltered.length < 10 ? 9 : 6);
            
            // Crea URL con markers
            const markers = filialiFiltered.map(f => 
                `&markers=color:red%7C${f.lat},${f.lng}`
            ).join('');
            
            const iframe = document.getElementById('googleMap');
            iframe.src = `https://www.google.com/maps/embed/v1/view?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&center=${avgLat},${avgLng}&zoom=${zoom}&maptype=roadmap`;
        }

        // INIZIALIZZA
        document.addEventListener('DOMContentLoaded', () => {
            setupAutocomplete();
            generateRecap(); // Genera recap statico di tutte le filiali
            generateFilialiCards(); // Popola lista nella cella destra
            
            // Search on enter
            document.getElementById('searchInput').addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    filterFiliali();
                }
            });
        });
    </script>
</body>
</html>
